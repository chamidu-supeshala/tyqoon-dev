"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[738],{85898:(b,_,o)=>{o.d(_,{b:()=>U});var c=o(15861),m=o(77579),d=o(82722),p=o(59468),g=o(49808),h=o(24837),x=o(95133),t=o(54463),f=o(36895),S=o(44466),C=o(59809),T=o(5565),Z=o(18110),r=o(94650),E=o(35482),u=o(94830),P=o(56889),v=o(23284),O=o(90147);function M(a,i){if(1&a&&r._UZ(0,"app-product-card",5),2&a){const e=i.$implicit,n=r.oxw().ngLet,s=r.oxw().ngLet;r.Q6J("product",e)("isBiddingMode",!!n)("isLogin",!!s)}}function A(a,i){1&a&&r._UZ(0,"app-product-card-skeleton",7)}const D=function(){return[]};function I(a,i){if(1&a&&(r.ynx(0),r.YNc(1,A,1,0,"app-product-card-skeleton",6),r.BQk()),2&a){const e=r.oxw(3);r.xp6(1),r.Q6J("ngForOf",r.DdM(2,D).constructor(e.pageSize).fill(1))("ngForTrackBy",e.trackByFn2)}}function L(a,i){if(1&a&&(r.TgZ(0,"div",2),r.YNc(1,M,1,3,"app-product-card",3),r.YNc(2,I,2,3,"ng-container",4),r.qZA()),2&a){const e=r.oxw(2);r.xp6(1),r.Q6J("ngForOf",e.products)("ngForTrackBy",e.trackByFn),r.xp6(1),r.Q6J("ngIf",e.isLoading)}}function R(a,i){if(1&a&&(r.TgZ(0,"div"),r.YNc(1,L,3,3,"div",1),r.ALo(2,"async"),r.qZA()),2&a){const e=r.oxw();r.xp6(1),r.Q6J("ngLet",r.lcZ(2,1,e.biddingService.isBiddingMode$))}}let U=(()=>{class a extends T.V{constructor(e,n,s,l){super(),this.productService=e,this.userService=n,this.biddingService=s,this.cdr=l,this.pageSize=20,this.offsetScroll=2e3,this.additionalParams={},this.isSSR=!1,this.biddingProductsSortOrder=0,this.throttleScroll=new m.x,this.page=-1,this.isLoading=!1,this.total=0,this.products=[],this.isBiddingMode=!1}ngOnInit(){console.log(8787878,this.biddingProductsSortOrder),!this.isSSR&&h.Z.isServer?this.isLoading=!0:this.biddingService.isBiddingMode$.pipe((0,d.R)(this.destroyStream$)).subscribe(e=>{this.isBiddingMode=e,this.refreshProducts()})}ngAfterViewInit(){var e=this;return(0,c.Z)(function*(){h.Z.isServer||e.scrollContainer&&(e.scrollElement=yield e.scrollContainer.getScrollElement(),e.scrollContainer.ionScroll.pipe((0,d.R)(e.destroyStream$)).subscribe(n=>{e.scrollElement.scrollHeight-n.detail.scrollTop<e.offsetScroll&&e.throttleScroll.next(1)}),e.throttleScroll.pipe((0,p.p)(300),(0,d.R)(e.destroyStream$)).subscribe(()=>{e.fetchData()}))})()}ngOnChanges(e){}refreshProducts(){this.page=-1,this.total=0,this.products=[],this.fetchData()}fetchData(){var e=this;return(0,c.Z)(function*(){if(!e.isLoading&&(-1===e.page||e.products.length<e.total)){e.isLoading=!0,e.page++,e.cdr.markForCheck();const n=e.isBiddingMode?yield(0,g.n)(e.biddingService.getProductsWithPoolInfo({page:e.page,rows:e.pageSize,sortType:e.biddingProductsSortOrder,isRecommended:!0,...e.additionalParams})):yield(0,g.n)(e.productService.getProductsByMetaParamsV2({page:e.page,rows:e.pageSize,traceId:e.userService.traceId,isRecommended:!0,...e.additionalParams}));console.log(n),n.rows=(0,Z.DI)(n.rows||[]),e.products=[...e.products,...n.rows||[]],e.total=n.total,e.isLoading=!1,e.cdr.markForCheck()}})()}clear(){this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}trackByFn(e,n){return n.id}trackByFn2(e){return e}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(E.s),r.Y36(u.K),r.Y36(P.g),r.Y36(r.sBO))},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-products-infinite-scroll"]],inputs:{pageSize:"pageSize",scrollContainer:"scrollContainer",offsetScroll:"offsetScroll",additionalParams:"additionalParams",isSSR:"isSSR",biddingProductsSortOrder:"biddingProductsSortOrder"},standalone:!0,features:[r.qOj,r.TTD,r.jDz],decls:2,vars:3,consts:[[4,"ngLet"],["class","grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-x-2 gap-y-6",4,"ngLet"],[1,"grid","grid-cols-2","xs:grid-cols-3","sm:grid-cols-4","md:grid-cols-5","lg:grid-cols-6","gap-x-2","gap-y-6"],["class","block",3,"product","isBiddingMode","isLogin",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"block",3,"product","isBiddingMode","isLogin"],["class","block",4,"ngFor","ngForOf","ngForTrackBy"],[1,"block"]],template:function(e,n){1&e&&(r.YNc(0,R,3,3,"div",0),r.ALo(1,"async")),2&e&&r.Q6J("ngLet",r.lcZ(1,1,n.userService.userInfo$))},dependencies:[t.aw,f.ez,f.sg,f.O5,f.Ov,x.Pc,S.m,v.Y,O.h,C.I],changeDetection:0}),a})()},50738:(b,_,o)=>{o.r(_),o.d(_,{PaymentModule:()=>a});var c=o(44466),m=o(7507),d=o(15861),p=o(11781),g=o(72588),h=o(82722),x=o(5565),t=o(94650),f=o(80164),S=o(81152),C=o(46032),T=o(8136),Z=o(49127),r=o(45210),E=o(18215),u=o(95133),P=o(36895),v=o(85898);const O=["header"];function M(i,e){if(1&i&&(t.TgZ(0,"span",15),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&i){const n=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,n.payResult.amount))}}function A(i,e){if(1&i){const n=t.EpF();t.TgZ(0,"ion-button",16),t.NdJ("click",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.pay())}),t._uU(1," \u7acb\u5373\u652f\u4ed8 "),t.qZA()}if(2&i){const n=t.oxw();t.Q6J("disabled",n.loading.platform)}}function D(i,e){1&i&&(t.TgZ(0,"ion-list",17)(1,"ion-item")(2,"ion-label")(3,"h3"),t._UZ(4,"ion-skeleton-text",18),t.qZA(),t.TgZ(5,"p"),t._UZ(6,"ion-skeleton-text",18),t.qZA(),t.TgZ(7,"p"),t._UZ(8,"ion-skeleton-text",18),t.qZA(),t.TgZ(9,"h3"),t._UZ(10,"ion-skeleton-text",18),t.qZA(),t.TgZ(11,"p"),t._UZ(12,"ion-skeleton-text",18),t.qZA(),t.TgZ(13,"p"),t._UZ(14,"ion-skeleton-text",18),t.qZA(),t.TgZ(15,"h3"),t._UZ(16,"ion-skeleton-text",18),t.qZA(),t.TgZ(17,"p"),t._UZ(18,"ion-skeleton-text",18),t.qZA(),t.TgZ(19,"p"),t._UZ(20,"ion-skeleton-text",18),t.qZA(),t.TgZ(21,"h3"),t._UZ(22,"ion-skeleton-text",18),t.qZA(),t.TgZ(23,"p"),t._UZ(24,"ion-skeleton-text",18),t.qZA(),t.TgZ(25,"p"),t._UZ(26,"ion-skeleton-text",18),t.qZA()()()()),2&i&&(t.xp6(4),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0))}const I=function(){return{isRecommended:!1,activityId:"40597823"}},R=[{path:"",component:(()=>{class i extends x.V{constructor(n,s,l,y){super(),this.activatedRoute=n,this.router=s,this.CheckoutService=l,this.renderer=y,this.PaymentPlatformEnum=p.fS,this.loading={getData:!1,platform:!1,pay:!1},this.lastScrollTop=0,this.successCallbackUri=""}get showPayBtn(){return Object.is(this.payResult?.platformCode.split("-").shift(),p.fS.STRIPE)}ngOnInit(){const{id:n}=this.activatedRoute.snapshot.queryParams;this.loading.getData=!0,this.loading.platform=!0,this.CheckoutService.queryPaymentOrder(n).pipe((0,h.R)(this.destroyStream$)).subscribe({next:s=>{if(this.payResult=s.data,console.log(this.payResult),Object.is(this.payResult?.status,p.P1.PENDING))switch(s.data.platformCode.split("-").shift()){case p.fS.STRIPE:this.loadStripe();break;case p.fS.TRIPLE:this.loadTriple()}else this.router.navigateByUrl(`/pay/result/${this.payResult?.id}`,{replaceUrl:!0})},error:s=>{console.error(s)}}).add(()=>this.loading.getData=!1)}onContentScroll(n){const s=n.detail.scrollTop;s>=50&&this.lastScrollTop<s?this.renderer.addClass(this.header.el,"top-toolbar-hide"):this.renderer.removeClass(this.header.el,"top-toolbar-hide"),this.lastScrollTop=s}loadStripe(){var n=this;return(0,d.Z)(function*(){try{const s=JSON.parse(n.payResult.clientJson),{clientSecret:l,pubKey:y,successUri:J}=s,B=yield(0,g.J)(y),k={text:"\u7b80\u4f53\u4e2d\u6587",abbr:"\u{1f1e8}\u{1f1f3}",stripe:"zh",tripleA:"zh"};if(n.successCallbackUri=J,!B)return;n.stripe=B,n.stripeElements=B.elements({appearance:{theme:"stripe"},locale:k.stripe,clientSecret:l}),n.stripeElements.create("payment").mount("#payment-element")}catch(s){console.error(s)}finally{n.loading.platform=!1}})()}loadTriple(){const n=JSON.parse(this.payResult.clientJson),s=document.querySelector("#payment-element");!s||(s.innerHTML=`\n  <triplea-ecommerce-payment-v1\n  id="payment"\n  payment-reference="${n.paymentReference}"\n  access-token="${n.accessToken}"\n  lang="zh"\n>\n</triplea-ecommerce-payment-v1>\n  `)}pay(){var n=this;return(0,d.Z)(function*(){const{platformCode:s}=n.payResult;s.split("-").shift()===p.fS.STRIPE&&n.stripePay()})()}stripePay(){var n=this;return(0,d.Z)(function*(){n.loading.pay=!0;try{const{error:s}=yield n.stripe.confirmPayment({elements:n.stripeElements,confirmParams:{return_url:n.successCallbackUri}});console.log(s)}catch(s){console.error(s)}finally{n.loading.pay=!1}})()}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(m.gz),t.Y36(m.F0),t.Y36(f.Z),t.Y36(t.Qsj))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-payment"]],viewQuery:function(n,s){if(1&n&&t.Gf(O,5),2&n){let l;t.iGM(l=t.CRH())&&(s.header=l.first)}},features:[t.qOj],decls:19,vars:10,consts:[["fullscreen","true","scrollEvents","true","backToTopBtn","",3,"ionScroll"],["ionContent",""],["appOverflowVisible","",1,"sticky","top-0","shadow-lg","z-50"],["header",""],[3,"forceFullWidthSearch"],[1,"w-full"],[1,"payment-container"],[1,"pay-amount"],["class","amount",4,"ngIf"],["id","payment-element"],["class","btn-pay","size","large","expand","block",3,"disabled","click",4,"ngIf"],["class","skeleton",4,"ngIf"],[1,"tyqoon-container","min-h-[50vh]","mt-4"],[3,"additionalParams","scrollContainer","isSSR"],[1,"mt-4","md:hidden"],[1,"amount"],["size","large","expand","block",1,"btn-pay",3,"disabled","click"],[1,"skeleton"],[2,"width","100%",3,"animated"]],template:function(n,s){if(1&n&&(t.TgZ(0,"ion-content",0,1),t.NdJ("ionScroll",function(y){return s.onContentScroll(y)}),t._UZ(2,"app-global-customer-service"),t.TgZ(3,"ion-toolbar",2,3),t._UZ(5,"app-top-navbar",4)(6,"app-top-menu"),t.qZA(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7),t._uU(10," \u652f\u4ed8\u91d1\u989d\uff1a"),t.YNc(11,M,3,3,"span",8),t.qZA(),t._UZ(12,"div",9),t.YNc(13,A,2,1,"ion-button",10),t.qZA(),t.YNc(14,D,27,12,"ion-list",11),t.qZA(),t.TgZ(15,"div",12),t._UZ(16,"app-products-infinite-scroll",13),t.qZA()(),t.TgZ(17,"ion-footer",14),t._UZ(18,"app-bottom-navbar"),t.qZA()),2&n){const l=t.MAs(1);t.xp6(5),t.Q6J("forceFullWidthSearch",!0),t.xp6(3),t.ekj("show",!s.loading.getData),t.xp6(3),t.Q6J("ngIf",s.payResult),t.xp6(2),t.Q6J("ngIf",s.showPayBtn),t.xp6(1),t.Q6J("ngIf",s.loading.getData),t.xp6(2),t.Q6J("additionalParams",t.DdM(9,I))("scrollContainer",l)("isSSR",!0)}},dependencies:[S.p,C.K,T.z,Z.H,r.B,E.Z,u.YG,u.W2,u.fr,u.Ie,u.Q$,u.q_,u.CK,u.sr,P.O5,v.b,P.H9],styles:[".payment-container[_ngcontent-%COMP%]{padding:32px 0;flex-direction:column;justify-content:center;max-width:800px;margin:0 auto;display:flex;height:0;overflow:hidden}.payment-container.show[_ngcontent-%COMP%]{min-height:70vh;height:auto;overflow:unset}.payment-container[_ngcontent-%COMP%]   .btn-pay[_ngcontent-%COMP%]{margin-top:24px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]{text-align:center;margin-bottom:12px;font-size:36px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:red;font-weight:700}.skeleton[_ngcontent-%COMP%]{min-height:70vh}"]}),i})()}];let U=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[m.Bz.forChild(R),m.Bz]}),i})(),a=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[c.m,U,u.Pc,v.b]}),i})()},59809:(b,_,o)=>{o.d(_,{I:()=>m});var c=o(94650);let m=(()=>{class d{}return d.\u0275fac=function(g){return new(g||d)},d.\u0275cmp=c.Xpm({type:d,selectors:[["app-product-card-skeleton"]],standalone:!0,features:[c.jDz],decls:9,vars:0,consts:[[1,"cursor-pointer","flex","flex-col","w-full","max-w-[246px]","lg:max-w-[220px]","xl:max-w-[245px]"],[1,"relative","w-full","mb-2",2,"padding-top","100%"],[1,"absolute","inset-0","pulSate","rounded-lg"],[1,"product-title","truncate","mb-1","pulSate","text-sm",2,"letter-spacing","20px"],[1,"text-xs","leading-3","text-center","pulSate",2,"letter-spacing","20px"],[1,"text-base","text-center","pulSate",2,"letter-spacing","20px"]],template:function(g,h){1&g&&(c.TgZ(0,"div",0)(1,"div",1),c._UZ(2,"div",2),c.qZA(),c.TgZ(3,"p",3),c._uU(4," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),c.qZA(),c.TgZ(5,"p",4),c._uU(6," \xa0\xa0 "),c.qZA(),c.TgZ(7,"p",5),c._uU(8," \xa0\xa0 "),c.qZA()())}}),d})()}}]);