"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[210,9127],{24499:(y,f,i)=>{i.d(f,{c:()=>_});var c=i(5565),s=i(94650);const p=["header"];let _=(()=>{class l extends c.V{constructor(a,h){super(),this.element=a,this.renderer=h,this.lastScrollTop=0}onContentScroll(a){const h=a.detail.scrollTop;h>=50&&this.lastScrollTop<h?this.renderer.addClass(this.header.el,"top-toolbar-hide"):this.renderer.removeClass(this.header.el,"top-toolbar-hide"),this.lastScrollTop=h}}return l.\u0275fac=function(a){return new(a||l)(s.Y36(s.SBq),s.Y36(s.Qsj))},l.\u0275cmp=s.Xpm({type:l,selectors:[["ng-component"]],viewQuery:function(a,h){if(1&a&&s.Gf(p,5),2&a){let t;s.iGM(t=s.CRH())&&(h.header=t.first)}},features:[s.qOj],decls:0,vars:0,template:function(a,h){},encapsulation:2}),l})()},85898:(y,f,i)=>{i.d(f,{b:()=>U});var c=i(15861),s=i(77579),p=i(82722),_=i(59468),l=i(49808),g=i(24837),a=i(95133),h=i(54463),t=i(36895),S=i(44466),P=i(59809),M=i(5565),v=i(18110),O=i(7507),n=i(94650),E=i(35482),C=i(94830),A=i(56889),D=i(23284),R=i(90147);function x(r,d){if(1&r&&n._UZ(0,"app-product-card",6),2&r){const e=d.$implicit,o=n.oxw().ngLet,u=n.oxw().ngLet,m=n.oxw().ngLet;n.Q6J("product",e)("isBiddingMode",!!o)("canLaunchPool",!!m)("isLogin",!!u)}}function I(r,d){1&r&&n._UZ(0,"app-product-card-skeleton",8)}const b=function(){return[]};function B(r,d){if(1&r&&(n.ynx(0),n.YNc(1,I,1,0,"app-product-card-skeleton",7),n.BQk()),2&r){const e=n.oxw(4);n.xp6(1),n.Q6J("ngForOf",n.DdM(2,b).constructor(e.pageSize).fill(1))("ngForTrackBy",e.trackByFn2)}}function K(r,d){if(1&r&&(n.TgZ(0,"div",3),n.YNc(1,x,1,4,"app-product-card",4),n.YNc(2,B,2,3,"ng-container",5),n.qZA()),2&r){const e=n.oxw(3);n.xp6(1),n.Q6J("ngForOf",e.products)("ngForTrackBy",e.trackByFn),n.xp6(1),n.Q6J("ngIf",e.isLoading)}}function Z(r,d){if(1&r&&(n.TgZ(0,"div"),n.YNc(1,K,3,3,"div",2),n.ALo(2,"async"),n.qZA()),2&r){const e=n.oxw(2);n.xp6(1),n.Q6J("ngLet",n.lcZ(2,1,e.biddingService.isBiddingMode$))}}function L(r,d){1&r&&(n.TgZ(0,"a",9),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&r&&(n.Q6J("routerLink","product/search"),n.xp6(1),n.hij(" ",n.lcZ(2,2,"see-more")," "))}function T(r,d){if(1&r&&(n.ynx(0),n.YNc(1,Z,3,3,"div",0),n.ALo(2,"async"),n.YNc(3,L,3,4,"a",1),n.BQk()),2&r){const e=n.oxw();n.xp6(1),n.Q6J("ngLet",n.lcZ(2,2,e.userService.userInfo$)),n.xp6(2),n.Q6J("ngIf",e.isBiddingMode)}}let U=(()=>{class r extends M.V{constructor(e,o,u,m){super(),this.productService=e,this.userService=o,this.biddingService=u,this.cdr=m,this.offsetScroll=2e3,this.additionalParams={},this.isSSR=!1,this.biddingProductsSortOrder=0,this.shoppingModePageSize=20,this.biddingModePageSize=18,this.throttleScroll=new s.x,this.pageSize=20,this.page=-1,this.isLoading=!1,this.total=0,this.products=[],this.isBiddingMode=!1,this.scrollActive$=new s.x}ngOnInit(){console.log(8787878,this.biddingProductsSortOrder),!this.isSSR&&g.Z.isServer?this.isLoading=!0:this.biddingService.isBiddingMode$.pipe((0,p.R)(this.destroyStream$)).subscribe(e=>{this.isBiddingMode=e,this.page=-1,this.products=[],this.pageSize=this.isBiddingMode?this.biddingModePageSize:this.shoppingModePageSize,this.cdr.detectChanges(),this.refreshProducts(),this.initInfiniteScrolling()})}ngOnDestroy(){super.ngOnDestroy(),this.clearSubscriptions()}clearSubscriptions(){this.scrollActive$?.next(!1),this.scrollActive$?.complete()}ngAfterViewInit(){g.Z.isServer||this.initInfiniteScrolling()}initInfiniteScrolling(){var e=this;return(0,c.Z)(function*(){e.clearSubscriptions(),e.scrollContainer&&!e.isBiddingMode&&(e.scrollActive$=new s.x,e.scrollElement=yield e.scrollContainer.getScrollElement(),e.scrollContainer.ionScroll.pipe((0,p.R)(e.scrollActive$)).subscribe(o=>{e.scrollElement.scrollHeight-o.detail.scrollTop<e.offsetScroll&&e.throttleScroll.next(1)}),e.throttleScroll.pipe((0,_.p)(300),(0,p.R)(e.scrollActive$)).subscribe(()=>{e.fetchData()}))})()}ngOnChanges(e){}refreshProducts(){this.page=-1,this.total=0,this.products=[],this.fetchData()}fetchData(e=null){var o=this;return(0,c.Z)(function*(){const u=e??o.page+1;if(!o.isLoading&&(0===u||o.products.length<o.total)){o.isLoading=!0,o.page=u,o.cdr.markForCheck();const m=o.isBiddingMode?yield(0,l.n)(o.biddingService.getProductsWithPoolInfo({page:o.page,rows:o.pageSize,sortType:o.biddingProductsSortOrder,isRecommended:!0,...o.additionalParams})):yield(0,l.n)(o.productService.getProductsByMetaParamsV2({page:o.page,rows:o.pageSize,traceId:o.userService.traceId,isRecommended:!0,...o.additionalParams}));m.rows=(0,v.DI)(m.rows||[]),o.products=[...o.products,...m.rows||[]],o.total=m.total,o.isLoading=!1,o.cdr.markForCheck()}})()}clear(){this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}trackByFn(e,o){return o.id}trackByFn2(e){return e}}return r.\u0275fac=function(e){return new(e||r)(n.Y36(E.s),n.Y36(C.K),n.Y36(A.g),n.Y36(n.sBO))},r.\u0275cmp=n.Xpm({type:r,selectors:[["app-products-infinite-scroll"]],inputs:{scrollContainer:"scrollContainer",offsetScroll:"offsetScroll",additionalParams:"additionalParams",isSSR:"isSSR",biddingProductsSortOrder:"biddingProductsSortOrder",shoppingModePageSize:"shoppingModePageSize",biddingModePageSize:"biddingModePageSize"},standalone:!0,features:[n.qOj,n.TTD,n.jDz],decls:2,vars:3,consts:[[4,"ngLet"],["class","px-6 py-1 capitalize mx-auto mt-4 mb-2 see-more block w-fit border border-solid rounded-lg text-2xl text-center font-medium text-white",3,"routerLink",4,"ngIf"],["class","grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-x-2 gap-y-6",4,"ngLet"],[1,"grid","grid-cols-2","xs:grid-cols-3","sm:grid-cols-4","md:grid-cols-5","lg:grid-cols-6","gap-x-2","gap-y-6"],["class","block",3,"product","isBiddingMode","canLaunchPool","isLogin",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"block",3,"product","isBiddingMode","canLaunchPool","isLogin"],["class","block",4,"ngFor","ngForOf","ngForTrackBy"],[1,"block"],[1,"px-6","py-1","capitalize","mx-auto","mt-4","mb-2","see-more","block","w-fit","border","border-solid","rounded-lg","text-2xl","text-center","font-medium","text-white",3,"routerLink"]],template:function(e,o){1&e&&(n.YNc(0,T,4,4,"ng-container",0),n.ALo(1,"async")),2&e&&n.Q6J("ngLet",n.lcZ(1,1,o.biddingService.canLaunchPool$))},dependencies:[h.aw,h.X$,t.ez,t.sg,t.O5,t.Ov,a.Pc,a.Fo,S.m,D.Y,R.h,P.I,O.Bz,O.yS],styles:[".see-more[_ngcontent-%COMP%]{background:linear-gradient(to right,#8467ff 0%,#eb00ff 100%);border-color:#9d2ec3;min-width:160px}.see-more[_ngcontent-%COMP%]:hover{color:#fff;background:linear-gradient(to right,#7454ff 0%,#bb00cb 100%)}"],changeDetection:0}),r})()},90210:(y,f,i)=>{i.r(f),i.d(f,{PayResultModule:()=>U});var c=i(88595),s=i(7507),p=i(15861),_=i(11781),l=i(6104),g=i(82722),a=i(15439),h=i(24499),t=i(94650),S=i(36895),P=i(95133),M=i(80164),v=i(54463),O=i(81152),n=i(46032),E=i(8136),C=i(49127),A=i(45210),D=i(18215),R=i(2628),x=i(85898);function I(r,d){if(1&r&&(t.TgZ(0,"div")(1,"div",18),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",19),t._uU(5),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"payment-remain-time")),t.xp6(3),t.Oqu(e.countdown())}}function b(r,d){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){t.CHM(e);const u=t.oxw();return t.KtG(u.cancelPayment())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"order-cancel-payment")))}const B=function(){return{isRecommended:!1,activityId:"40597823"}},Z=[{path:"",component:(()=>{class r extends h.c{constructor(e,o,u,m,F,W,Y,z,k){super(z,Y),this.activeRoute=e,this.location=o,this.dict=u,this.router=m,this.toast=F,this.CheckoutService=W,this.renderer=Y,this.element=z,this.translate=k,this.DictKey=l.f,this.loading={queryPaymentOrder:!1}}ngOnInit(){this.orderId=this.activeRoute.snapshot.params.id,this.queryPaymentOrder(),setInterval(()=>{this.countdown()},1e3)}ngOnDestroy(){this.destroy(),clearInterval(this.payResultSetTimeout)}get bussinessType(){return this.dict.transform(this.payResult.businessType,this.DictKey.PAY_BUSINESS_TYPE)}get isPending(){return Object.is(this.payResult.status,_.P1.PENDING)}get primaryBtnText(){return this.isPending?"\u7acb\u5373\u652f\u4ed8":this.bussinessType.primaryBtnText}convertToDecimal(e){return e<10&&(e=0+e.toString()),e}countdown(){const e=a(this.payResult.businessExpired).unix()-a().unix(),o=this.convertToDecimal(a.duration(e,"seconds").minutes()),u=this.convertToDecimal(a.duration(e,"seconds").seconds());return this.payResult.businessExpired<(new Date).getTime()?"00:00:00":`00: ${o} : ${u}`}toastError(e){var o=this;return(0,p.Z)(function*(){yield o.presentToast({position:"bottom",message:e,icon:"alert-circle-outline",duration:1e3,color:"danger"})})()}toastSuccess(e){var o=this;return(0,p.Z)(function*(){yield o.presentToast({position:"bottom",message:e,duration:1e3,icon:"checkmark-circle-outline",color:"success"})})()}presentToast(e){var o=this;return(0,p.Z)(function*(){yield(yield o.toast.create(e)).present()})()}queryPaymentOrder(e){e||(this.loading.queryPaymentOrder=!0),this.CheckoutService.queryPaymentOrder(this.orderId).pipe((0,g.R)(this.destroyStream$)).subscribe({next:o=>{this.payResult={...o.data,expiredTime:1e3*o.data.expiredTime,businessExpired:1e3*o.data.businessExpired},Object.is(this.payResult.status,_.P1.PENDING)&&(this.payResultSetTimeout=setTimeout(()=>this.queryPaymentOrder(!0),2e3))},error:o=>{console.error(o),this.toastError(o.message)}}).add(()=>this.loading.queryPaymentOrder=!1)}primaryBtnClick(){this.isPending?this.router.navigateByUrl(`/pay?id=${this.payResult.id}`):this.router.navigateByUrl(this.bussinessType.link,{replaceUrl:!0})}back(){this.location.back()}cancelPayment(){this.CheckoutService.cancel({id:this.orderId}).pipe((0,g.R)(this.destroyStream$)).subscribe()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(s.gz),t.Y36(S.Ye),t.Y36(l.e),t.Y36(s.F0),t.Y36(P.yF),t.Y36(M.Z),t.Y36(t.Qsj),t.Y36(t.SBq),t.Y36(v.sK))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-pay-result"]],features:[t._Bn([l.e]),t.qOj],decls:28,vars:21,consts:[[1,"page-pay-result"],["fullscreen","true","scrollEvents","true","backToTopBtn","",3,"ionScroll"],["ionContent",""],["appOverflowVisible","",1,"sticky","top-0","shadow-lg","z-50"],["header",""],[3,"forceFullWidthSearch"],[1,"w-full"],[1,"pay_title"],[1,"pending"],[4,"ngIf"],[3,"content"],[1,"btn-spot"],["color","warning",3,"click"],["color","light",3,"click"],["color","danger","class","cancel-payment",3,"click",4,"ngIf"],[1,"tyqoon-container","min-h-[50vh]","mt-4"],[3,"additionalParams","scrollContainer","isSSR"],[1,"mt-4","md:hidden"],[1,"statistic-title"],[1,"timestamp","main-title"],["color","danger",1,"cancel-payment",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"ion-content",1,2),t.NdJ("ionScroll",function(m){return o.onContentScroll(m)}),t._UZ(3,"app-global-customer-service"),t.TgZ(4,"ion-toolbar",3,4),t._UZ(6,"app-top-navbar",5)(7,"app-top-menu"),t.qZA(),t.TgZ(8,"div",6)(9,"div",7),t._uU(10),t.ALo(11,"translate"),t.ALo(12,"dict"),t.qZA(),t.TgZ(13,"div",8),t.YNc(14,I,6,4,"div",9),t._UZ(15,"app-pay-content",10),t.qZA(),t.TgZ(16,"div",11)(17,"ion-button",12),t.NdJ("click",function(){return o.primaryBtnClick()}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"ion-button",13),t.NdJ("click",function(){return o.back()}),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.YNc(23,b,3,3,"ion-button",14),t.qZA()(),t.TgZ(24,"div",15),t._UZ(25,"app-products-infinite-scroll",16),t.qZA()(),t.TgZ(26,"ion-footer",17),t._UZ(27,"app-bottom-navbar"),t.qZA()()),2&e){const u=t.MAs(2);t.xp6(6),t.Q6J("forceFullWidthSearch",!0),t.xp6(4),t.Oqu(t.lcZ(11,10,t.Dn7(12,12,o.payResult.status,o.DictKey.PAY_STATUS,"tips"))),t.xp6(4),t.Q6J("ngIf",o.isPending),t.xp6(1),t.Q6J("content",o.payResult),t.xp6(3),t.Oqu(t.lcZ(19,16,o.primaryBtnText)),t.xp6(3),t.Oqu(t.lcZ(22,18,"go-back")),t.xp6(2),t.Q6J("ngIf",o.isPending),t.xp6(2),t.Q6J("additionalParams",t.DdM(20,B))("scrollContainer",u)("isSSR",!0)}},dependencies:[O.p,n.K,E.z,C.H,A.B,D.Z,R.k,P.YG,P.W2,P.fr,P.sr,S.O5,x.b,l.e,v.X$],styles:[".page-pay-result[_ngcontent-%COMP%]{min-height:70vh;display:flex;justify-content:center;align-items:center;inset:0;position:absolute;flex-direction:column;contain:layout size style;overflow:hidden;z-index:0}.page-pay-result[_ngcontent-%COMP%]   .pay_title[_ngcontent-%COMP%]{color:#000000d9;font-size:24px;line-height:1.8;text-align:center;padding-top:50px}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]{text-align:center}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]   .statistic-title[_ngcontent-%COMP%]{margin-bottom:4px;color:#00000073;font-size:14px}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]   .main-title[_ngcontent-%COMP%]{color:#000000d9;font-size:24px}.page-pay-result[_ngcontent-%COMP%]   .cancel-payment[_ngcontent-%COMP%]{color:#fff;margin-left:5%}.page-pay-result[_ngcontent-%COMP%]   .btn-spot[_ngcontent-%COMP%]{margin:24px 0 0;text-align:center}"]}),r})()}];let L=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[s.Bz.forChild(Z),s.Bz]}),r})();var T=i(44466);let U=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[T.m,L,c.g,T.m,P.Pc,v.aw,x.b]}),r})()},59809:(y,f,i)=>{i.d(f,{I:()=>s});var c=i(94650);let s=(()=>{class p{}return p.\u0275fac=function(l){return new(l||p)},p.\u0275cmp=c.Xpm({type:p,selectors:[["app-product-card-skeleton"]],standalone:!0,features:[c.jDz],decls:9,vars:0,consts:[[1,"cursor-pointer","flex","flex-col","w-full","max-w-[246px]","lg:max-w-[220px]","xl:max-w-[245px]"],[1,"relative","w-full","mb-2",2,"padding-top","100%"],[1,"absolute","inset-0","pulSate","rounded-lg"],[1,"product-title","truncate","mb-1","pulSate","text-sm",2,"letter-spacing","20px"],[1,"text-xs","leading-3","text-center","pulSate",2,"letter-spacing","20px"],[1,"text-base","text-center","pulSate",2,"letter-spacing","20px"]],template:function(l,g){1&l&&(c.TgZ(0,"div",0)(1,"div",1),c._UZ(2,"div",2),c.qZA(),c.TgZ(3,"p",3),c._uU(4," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),c.qZA(),c.TgZ(5,"p",4),c._uU(6," \xa0\xa0 "),c.qZA(),c.TgZ(7,"p",5),c._uU(8," \xa0\xa0 "),c.qZA()())}}),p})()},49127:(y,f,i)=>{i.d(f,{H:()=>p});var c=i(24837),s=i(94650);let p=(()=>{class _{constructor(g){this.toolbar=g.nativeElement}ngAfterViewInit(){if(c.Z.isServer)return;const g=setInterval(()=>{if(this.toolbar.shadowRoot){let a=this.toolbar.shadowRoot.querySelector(".toolbar-container");a&&(a.style.contain="none",a.style.overflow="visible",clearInterval(g))}},500)}}return _.\u0275fac=function(g){return new(g||_)(s.Y36(s.SBq))},_.\u0275dir=s.lG2({type:_,selectors:[["","appOverflowVisible",""]]}),_})()}}]);