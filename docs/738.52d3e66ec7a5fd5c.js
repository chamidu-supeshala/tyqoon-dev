"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[738],{85898:(K,x,o)=>{o.d(x,{b:()=>W});var c=o(15861),P=o(77579),p=o(82722),g=o(59468),v=o(49808),M=o(24837),O=o(95133),Z=o(54463),S=o(36895),D=o(44466),t=o(59809),U=o(5565),C=o(18110),E=o(81212),n=o(94650),I=o(35482),R=o(45329),f=o(56889),A=o(23284),b=o(90147);function B(l,_){if(1&l&&n._UZ(0,"app-product-card",6),2&l){const i=_.$implicit,s=n.oxw().ngLet,y=n.oxw().ngLet;n.Q6J("product",i)("isBiddingMode",!!s)("isLogin",!!y)}}function L(l,_){1&l&&n._UZ(0,"app-product-card-skeleton",8)}const k=function(){return[]};function J(l,_){if(1&l&&(n.ynx(0),n.YNc(1,L,1,0,"app-product-card-skeleton",7),n.BQk()),2&l){const i=n.oxw(3);n.xp6(1),n.Q6J("ngForOf",n.DdM(2,k).constructor(i.pageSize).fill(1))("ngForTrackBy",i.trackByFn2)}}function F(l,_){if(1&l&&(n.TgZ(0,"div",3),n.YNc(1,B,1,3,"app-product-card",4),n.YNc(2,J,2,3,"ng-container",5),n.qZA()),2&l){const i=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",i.products)("ngForTrackBy",i.trackByFn),n.xp6(1),n.Q6J("ngIf",i.isLoading)}}function z(l,_){if(1&l&&(n.TgZ(0,"div"),n.YNc(1,F,3,3,"div",2),n.ALo(2,"async"),n.qZA()),2&l){const i=n.oxw();n.xp6(1),n.Q6J("ngLet",n.lcZ(2,1,i.biddingService.isBiddingMode$))}}function Q(l,_){1&l&&(n.TgZ(0,"a",9),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&l&&(n.Q6J("routerLink","product/search"),n.xp6(1),n.hij(" ",n.lcZ(2,2,"see-more"),"\n"))}let W=(()=>{class l extends U.V{constructor(i,s,y,r){super(),this.productService=i,this.userService=s,this.biddingService=y,this.cdr=r,this.offsetScroll=2e3,this.additionalParams={},this.isSSR=!1,this.biddingProductsSortOrder=0,this.shoppingModePageSize=20,this.biddingModePageSize=18,this.throttleScroll=new P.x,this.pageSize=20,this.page=-1,this.isLoading=!1,this.total=0,this.products=[],this.isBiddingMode=!1,this.scrollActive$=new P.x}ngOnInit(){console.log(8787878,this.biddingProductsSortOrder),!this.isSSR&&M.Z.isServer?this.isLoading=!0:this.biddingService.isBiddingMode$.pipe((0,p.R)(this.destroyStream$)).subscribe(i=>{this.isBiddingMode=i,this.page=-1,this.products=[],this.pageSize=this.isBiddingMode?this.biddingModePageSize:this.shoppingModePageSize,this.cdr.detectChanges(),this.refreshProducts(),this.initInfiniteScrolling()})}ngOnDestroy(){super.ngOnDestroy(),this.clearSubscriptions()}clearSubscriptions(){this.scrollActive$?.next(!1),this.scrollActive$?.complete()}ngAfterViewInit(){M.Z.isServer||this.initInfiniteScrolling()}initInfiniteScrolling(){var i=this;return(0,c.Z)(function*(){i.clearSubscriptions(),i.scrollContainer&&!i.isBiddingMode&&(i.scrollActive$=new P.x,i.scrollElement=yield i.scrollContainer.getScrollElement(),i.scrollContainer.ionScroll.pipe((0,p.R)(i.scrollActive$)).subscribe(s=>{i.scrollElement.scrollHeight-s.detail.scrollTop<i.offsetScroll&&i.throttleScroll.next(1)}),i.throttleScroll.pipe((0,g.p)(300),(0,p.R)(i.scrollActive$)).subscribe(()=>{i.fetchData()}))})()}ngOnChanges(i){}refreshProducts(){this.page=-1,this.total=0,this.products=[],this.fetchData()}fetchData(i=null){var s=this;return(0,c.Z)(function*(){const y=i??s.page+1;if(!s.isLoading&&(0===y||s.products.length<s.total)){s.isLoading=!0,s.page=y,s.cdr.markForCheck();const r=s.isBiddingMode?yield(0,v.n)(s.biddingService.getProductsWithPoolInfo({page:s.page,rows:s.pageSize,sortType:s.biddingProductsSortOrder,isRecommended:!0,...s.additionalParams})):yield(0,v.n)(s.productService.getProductsByMetaParamsV2({page:s.page,rows:s.pageSize,traceId:s.userService.traceId,isRecommended:!0,...s.additionalParams}));r.rows=(0,C.DI)(r.rows||[]),s.products=[...s.products,...r.rows||[]],s.total=r.total,s.isLoading=!1,s.cdr.markForCheck()}})()}clear(){this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}trackByFn(i,s){return s.id}trackByFn2(i){return i}}return l.\u0275fac=function(i){return new(i||l)(n.Y36(I.s),n.Y36(R.K),n.Y36(f.g),n.Y36(n.sBO))},l.\u0275cmp=n.Xpm({type:l,selectors:[["app-products-infinite-scroll"]],inputs:{scrollContainer:"scrollContainer",offsetScroll:"offsetScroll",additionalParams:"additionalParams",isSSR:"isSSR",biddingProductsSortOrder:"biddingProductsSortOrder",shoppingModePageSize:"shoppingModePageSize",biddingModePageSize:"biddingModePageSize"},standalone:!0,features:[n.qOj,n.TTD,n.jDz],decls:3,vars:4,consts:[[4,"ngLet"],["class","px-6 py-1 capitalize mx-auto mt-4 mb-2 see-more block w-fit border border-solid rounded-lg text-2xl text-center font-medium text-white",3,"routerLink",4,"ngIf"],["class","grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-x-2 gap-y-6",4,"ngLet"],[1,"grid","grid-cols-2","xs:grid-cols-3","sm:grid-cols-4","md:grid-cols-5","lg:grid-cols-6","gap-x-2","gap-y-6"],["class","block",3,"product","isBiddingMode","isLogin",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"block",3,"product","isBiddingMode","isLogin"],["class","block",4,"ngFor","ngForOf","ngForTrackBy"],[1,"block"],[1,"px-6","py-1","capitalize","mx-auto","mt-4","mb-2","see-more","block","w-fit","border","border-solid","rounded-lg","text-2xl","text-center","font-medium","text-white",3,"routerLink"]],template:function(i,s){1&i&&(n.YNc(0,z,3,3,"div",0),n.ALo(1,"async"),n.YNc(2,Q,3,4,"a",1)),2&i&&(n.Q6J("ngLet",n.lcZ(1,2,s.userService.userInfo$)),n.xp6(2),n.Q6J("ngIf",s.isBiddingMode))},dependencies:[Z.aw,Z.X$,S.ez,S.sg,S.O5,S.Ov,O.Pc,O.Fo,D.m,A.Y,b.h,t.I,E.Bz,E.yS],styles:[".see-more[_ngcontent-%COMP%]{background:linear-gradient(to right,#8467ff 0%,#eb00ff 100%);border-color:#9d2ec3;min-width:160px}.see-more[_ngcontent-%COMP%]:hover{color:#fff;background:linear-gradient(to right,#7454ff 0%,#bb00cb 100%)}"],changeDetection:0}),l})()},50738:(K,x,o)=>{o.r(x),o.d(x,{PaymentModule:()=>y});var c=o(44466),P=o(81212),p=o(15861),g=o(11781),v=o(72588),M=o(82722),O=o(5565),Z=o(83905),S=o(5963),D=o(24837),t=o(94650),U=o(80164),C=o(36895),E=o(46032),n=o(49127),I=o(45210),R=o(18215),f=o(95133),A=o(85898),b=o(28151),B=o(93774);const L=["header"];function k(r,u){if(1&r&&(t.TgZ(0,"span",17),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.payResult.amount))}}function J(r,u){if(1&r){const e=t.EpF();t._UZ(0,"div",18),t.TgZ(1,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const d=t.oxw();return t.KtG(d.pay())}),t._uU(2," \u7acb\u5373\u652f\u4ed8 "),t.qZA()}if(2&r){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.loading.platform)}}function F(r,u){1&r&&t._UZ(0,"div",20)}function z(r,u){}function Q(r,u){1&r&&(t.TgZ(0,"ion-list",21)(1,"ion-item")(2,"ion-label")(3,"h3"),t._UZ(4,"ion-skeleton-text",22),t.qZA(),t.TgZ(5,"p"),t._UZ(6,"ion-skeleton-text",22),t.qZA(),t.TgZ(7,"p"),t._UZ(8,"ion-skeleton-text",22),t.qZA(),t.TgZ(9,"h3"),t._UZ(10,"ion-skeleton-text",22),t.qZA(),t.TgZ(11,"p"),t._UZ(12,"ion-skeleton-text",22),t.qZA(),t.TgZ(13,"p"),t._UZ(14,"ion-skeleton-text",22),t.qZA(),t.TgZ(15,"h3"),t._UZ(16,"ion-skeleton-text",22),t.qZA(),t.TgZ(17,"p"),t._UZ(18,"ion-skeleton-text",22),t.qZA(),t.TgZ(19,"p"),t._UZ(20,"ion-skeleton-text",22),t.qZA(),t.TgZ(21,"h3"),t._UZ(22,"ion-skeleton-text",22),t.qZA(),t.TgZ(23,"p"),t._UZ(24,"ion-skeleton-text",22),t.qZA(),t.TgZ(25,"p"),t._UZ(26,"ion-skeleton-text",22),t.qZA()()()()),2&r&&(t.xp6(4),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0))}const W=function(){return{isRecommended:!1,activityId:"40597823"}},_=[{path:"",component:(()=>{class r extends O.V{constructor(e,a,d,m){super(),this.activatedRoute=e,this.router=a,this.CheckoutService=d,this.renderer=m,this.PaymentPlatformEnum=g.fS,this.loading={getData:!1,platform:!1,pay:!1},this.lastScrollTop=0,this.successCallbackUri=""}get paymentPlatform(){return this.payResult?.platformCode.split("-").shift()}ngOnInit(){var e=this;const{id:a}=this.activatedRoute.snapshot.queryParams;var d;this.loading.getData=!0,this.loading.platform=!0,this.CheckoutService.queryPaymentOrder(a).pipe((0,M.R)(this.destroyStream$)).subscribe({next:(d=(0,p.Z)(function*(m){if(e.payResult=m.data,console.log(e.payResult),Object.is(e.payResult?.status,g.P1.PENDING))switch(D.Z.isBrowser&&(yield(0,Z.z)((0,S.H)(100))),e.paymentPlatform){case g.fS.STRIPE:e.loadStripe();break;case g.fS.PAY_2C2P:e.load2C2P();break;case g.fS.TRIPLE:e.loadTriple()}else e.router.navigateByUrl(`/pay/result/${e.payResult?.id}`,{replaceUrl:!0})}),function(h){return d.apply(this,arguments)}),error:d=>{console.error(d)}}).add(()=>this.loading.getData=!1)}onContentScroll(e){const a=e.detail.scrollTop;a>=50&&this.lastScrollTop<a?this.renderer.addClass(this.header.el,"top-toolbar-hide"):this.renderer.removeClass(this.header.el,"top-toolbar-hide"),this.lastScrollTop=a}load2C2P(){var e=this;return(0,p.Z)(function*(){if(!e.payResult?.paymentUrl)return;const a=JSON.parse(e.payResult.clientJson);e.successCallbackUri=a?.successUri;const d={url:e.payResult.paymentUrl,templateId:"ikea",mode:"DropIn",cancelConfirmation:!0},{PGWSDK:m}=window;m.paymentUI(d,h=>{console.log("RES!!!",h),"0003"===h.responseCode||"2000"===h.responseCode?window.location.href=e.successCallbackUri:console.log("Response callback: "+h.paymentToken+" // "+h.responseCode+" // "+h.responseDescription)})})()}loadStripe(){var e=this;return(0,p.Z)(function*(){try{const a=JSON.parse(e.payResult.clientJson),{clientSecret:d,pubKey:m,successUri:h}=a,T=yield(0,v.J)(m),Y={text:"\u7b80\u4f53\u4e2d\u6587",abbr:"\u{1f1e8}\u{1f1f3}",stripe:"zh",tripleA:"zh"};if(e.successCallbackUri=h,!T)return;e.stripe=T,e.stripeElements=T.elements({appearance:{theme:"stripe"},locale:Y.stripe,clientSecret:d}),e.stripeElements.create("payment").mount("#payment-element")}catch(a){console.error(a)}finally{e.loading.platform=!1}})()}loadTriple(){const e=JSON.parse(this.payResult.clientJson),a=document.querySelector("#payment-element");!a||(a.innerHTML=`\n  <triplea-ecommerce-payment-v1\n  id="payment"\n  payment-reference="${e.paymentReference}"\n  access-token="${e.accessToken}"\n  lang="zh"\n>\n</triplea-ecommerce-payment-v1>\n  `)}pay(){var e=this;return(0,p.Z)(function*(){const{platformCode:a}=e.payResult;a.split("-").shift()===g.fS.STRIPE&&e.stripePay()})()}stripePay(){var e=this;return(0,p.Z)(function*(){e.loading.pay=!0;try{const{error:a}=yield e.stripe.confirmPayment({elements:e.stripeElements,confirmParams:{return_url:e.successCallbackUri}});console.log(a)}catch(a){console.error(a)}finally{e.loading.pay=!1}})()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(P.gz),t.Y36(P.F0),t.Y36(U.Z),t.Y36(t.Qsj))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-payment"]],viewQuery:function(e,a){if(1&e&&t.Gf(L,5),2&e){let d;t.iGM(d=t.CRH())&&(a.header=d.first)}},features:[t.qOj],decls:24,vars:10,consts:[["fullscreen","true","scrollEvents","true","backToTopBtn","",3,"ionScroll"],["ionContent",""],["appOverflowVisible","",1,"sticky","top-0","shadow-lg","z-50"],["header",""],[3,"forceFullWidthSearch"],[1,"w-full"],[1,"payment-container"],[1,"pay-amount"],["class","amount",4,"ngIf"],[3,"ngTemplateOutlet"],["paymentElementStripe",""],["paymentElement2C2P",""],["paymentElementTripple",""],["class","skeleton",4,"ngIf"],[1,"tyqoon-container","min-h-[50vh]","mt-4"],[3,"additionalParams","scrollContainer","isSSR"],[1,"mt-4","md:hidden"],[1,"amount"],["id","payment-element"],["size","large","expand","block",1,"btn-pay",3,"disabled","click"],["id","pgw-ui-container"],[1,"skeleton"],[2,"width","100%",3,"animated"]],template:function(e,a){if(1&e&&(t.TgZ(0,"ion-content",0,1),t.NdJ("ionScroll",function(m){return a.onContentScroll(m)}),t._UZ(2,"app-global-customer-service"),t.TgZ(3,"ion-toolbar",2,3),t._UZ(5,"app-top-navbar",4)(6,"app-top-menu"),t.qZA(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7),t._uU(10," \u652f\u4ed8\u91d1\u989d\uff1a"),t.YNc(11,k,3,3,"span",8),t.qZA(),t.GkF(12,9),t.YNc(13,J,3,1,"ng-template",null,10,t.W1O),t.YNc(15,F,1,0,"ng-template",null,11,t.W1O),t.YNc(17,z,0,0,"ng-template",null,12,t.W1O),t.qZA(),t.YNc(19,Q,27,12,"ion-list",13),t.qZA(),t.TgZ(20,"div",14),t._UZ(21,"app-products-infinite-scroll",15),t.qZA()(),t.TgZ(22,"ion-footer",16),t._UZ(23,"app-bottom-navbar"),t.qZA()),2&e){const d=t.MAs(1),m=t.MAs(14),h=t.MAs(16),T=t.MAs(18);t.xp6(5),t.Q6J("forceFullWidthSearch",!0),t.xp6(3),t.ekj("show",!a.loading.getData),t.xp6(3),t.Q6J("ngIf",a.payResult),t.xp6(1),t.Q6J("ngTemplateOutlet",a.paymentPlatform===a.PaymentPlatformEnum.STRIPE?m:a.paymentPlatform===a.PaymentPlatformEnum.PAY_2C2P?h:T),t.xp6(7),t.Q6J("ngIf",a.loading.getData),t.xp6(2),t.Q6J("additionalParams",t.DdM(9,W))("scrollContainer",d)("isSSR",!0)}},dependencies:[C.O5,C.tP,E.K,n.H,I.B,R.Z,f.YG,f.W2,f.fr,f.Ie,f.Q$,f.q_,f.CK,f.sr,A.b,b.p,B.z,C.H9],styles:[".payment-container[_ngcontent-%COMP%]{padding:32px 0;flex-direction:column;justify-content:center;max-width:800px;margin:0 auto;display:flex;height:0;overflow:hidden}.payment-container.show[_ngcontent-%COMP%]{min-height:70vh;height:auto;overflow:unset}.payment-container[_ngcontent-%COMP%]   .btn-pay[_ngcontent-%COMP%]{margin-top:24px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]{text-align:center;margin-bottom:12px;font-size:36px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:red;font-weight:700}.skeleton[_ngcontent-%COMP%]{min-height:70vh}#pgw-ui-container[_ngcontent-%COMP%]{min-height:430px}#pgw-ui-container[_ngcontent-%COMP%]     #pgw-ui-container-dropin{min-height:430px}#pgw-ui-container[_ngcontent-%COMP%]     #pgw-ui-container-dropin iframe{min-height:430px}"]}),r})()}];let i=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[P.Bz.forChild(_),P.Bz]}),r})();var s=o(1241);let y=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[C.ez,c.m,i,f.Pc,A.b,s.x]}),r})()},59809:(K,x,o)=>{o.d(x,{I:()=>P});var c=o(94650);let P=(()=>{class p{}return p.\u0275fac=function(v){return new(v||p)},p.\u0275cmp=c.Xpm({type:p,selectors:[["app-product-card-skeleton"]],standalone:!0,features:[c.jDz],decls:9,vars:0,consts:[[1,"cursor-pointer","flex","flex-col","w-full","max-w-[246px]","lg:max-w-[220px]","xl:max-w-[245px]"],[1,"relative","w-full","mb-2",2,"padding-top","100%"],[1,"absolute","inset-0","pulSate","rounded-lg"],[1,"product-title","truncate","mb-1","pulSate","text-sm",2,"letter-spacing","20px"],[1,"text-xs","leading-3","text-center","pulSate",2,"letter-spacing","20px"],[1,"text-base","text-center","pulSate",2,"letter-spacing","20px"]],template:function(v,M){1&v&&(c.TgZ(0,"div",0)(1,"div",1),c._UZ(2,"div",2),c.qZA(),c.TgZ(3,"p",3),c._uU(4," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),c.qZA(),c.TgZ(5,"p",4),c._uU(6," \xa0\xa0 "),c.qZA(),c.TgZ(7,"p",5),c._uU(8," \xa0\xa0 "),c.qZA()())}}),p})()}}]);