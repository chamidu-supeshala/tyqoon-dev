"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[738],{80164:(B,E,e)=>{e.d(E,{Z:()=>x});var a=e(92340),h=e(54004),d=e(94650),_=e(80529),P=e(94830);let x=(()=>{class t{constructor(n,i){this.http=n,this.userService=i}QueryByBusiness(n,i){return this.http.get(`${a.N.BASE_URL}/payment/QueryByBusiness?businessType=${n}&businessId=${i}`)}cancel(n){return this.http.post(`${a.N.BASE_URL}/payment/cancel`,n)}queryPlatformList(){return this.http.get(`${a.N.BASE_URL}/payment/queryPlatformList`)}queryPaymentOrder(n){return this.http.get(`${a.N.BASE_URL}/payment/queryPaymentOrder?id=${n}`)}getShippingAddress(){return this.http.get(`${a.N.BASE_URL}/user/receiver/getReceiverAddress?page=0&rows=30`)}getShippingFee(n,i,f){return this.http.get(`${a.N.BASE_URL}/shop/product/getFreight`,{params:{receiverId:n,skuId:i,quantity:f}})}getAreaCanBuy(n,i,f){return this.http.get(`${a.N.BASE_URL}/shop/product/getDeliverable`,{params:{receiverId:n,skuId:i,quantity:f}})}getAddressDetail(n){return this.http.get(`${a.N.BASE_URL}/user/receiver/getReceiverAddressDetails`,{params:{id:n}}).pipe((0,h.U)(i=>(i.data.areaDetails=i.data.areaDetails?.map(f=>({label:f.label,value:f.value.toString()})),i)))}getAreaData(n){return this.http.get(`${a.N.BASE_URL}/user/receiver/getAreaData`,{params:{parentId:n||""}})}saveAddress(n){return this.http.post(`${a.N.BASE_URL}/user/receiver/updateReceiverAddress`,n)}createNewAddress(n){return this.http.post(`${a.N.BASE_URL}/user/receiver/saveReceiverAddress`,n)}getOrderSum(n){return this.http.post(`${a.N.BASE_URL}/user/order/getOrderAmount`,n).pipe((0,h.U)(({data:i})=>({originalPrice:parseFloat(i.originalPrice),toTalTQC:parseFloat(i.toTalTQC),totalSumDiscount:parseFloat(i.totalSumDiscount),totalSumFreight:parseFloat(i.totalSumFreight),totalSumPoint:parseFloat(i.totalSumPoint),totalSumPrice:parseFloat(i.totalSumPrice),totalSumQuantity:i.totalSumQuantity,isIdentify:i.isIdentify,isOpenUpDomesticPaymentMethods:i.isOpenUpDomesticPaymentMethods})))}getExpress(n,i){return this.http.get(`${a.N.BASE_URL}/user/order/getExpress?orderId=${n}&expressNum=${i}`).pipe((0,h.U)(f=>f.data))}lockOrder(n){return this.http.post(`${a.N.BASE_URL}/user/order/lockOrder`,n)}queryLockOrder(n){return this.http.get(`${a.N.BASE_URL}/user/order/queryLockOrder?sn=${n}`)}submitLockOrder(n){return this.http.post(`${a.N.BASE_URL}/user/order/submitLockOrder`,n)}querySubmitOrder(n){return this.http.get(`${a.N.BASE_URL}/user/order/querySubmitOrder?sn=${n}`)}productToOrder(n){return this.http.post(`${a.N.BASE_URL}/user/order/productToOrder`,n)}balancePayment(n){return this.http.post(`${a.N.BASE_URL}/user/order/balancePayment`,n)}queryExchangeCodeAmount(n){return this.http.get(`${a.N.BASE_URL}/user/order/queryExchangeCodeAmount?code=${n}`).pipe((0,h.U)(i=>i.data))}exchangeCode(n){return this.http.post(`${a.N.BASE_URL}/user/order/exchangeCode`,n)}}return t.\u0275fac=function(n){return new(n||t)(d.LFG(_.eN),d.LFG(P.K))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},85898:(B,E,e)=>{e.d(E,{b:()=>I});var a=e(15861),h=e(77579),d=e(82722),_=e(59468),P=e(49808),O=e(24837),x=e(95133),t=e(54463),C=e(36895),n=e(44466),i=e(59809),f=e(5565),S=e(18110),o=e(94650),u=e(35482),l=e(94830),m=e(23284);function T(g,R){1&g&&o._UZ(0,"app-product-card",3),2&g&&o.Q6J("product",R.$implicit)}function D(g,R){1&g&&o._UZ(0,"app-product-card-skeleton",5)}const Z=function(){return[]};function L(g,R){if(1&g&&(o.ynx(0),o.YNc(1,D,1,0,"app-product-card-skeleton",4),o.BQk()),2&g){const r=o.oxw();o.xp6(1),o.Q6J("ngForOf",o.DdM(2,Z).constructor(r.pageSize).fill(1))("ngForTrackBy",r.trackByFn2)}}let I=(()=>{class g extends f.V{constructor(r,y,M){super(),this.productService=r,this.userService=y,this.cdr=M,this.pageSize=20,this.offsetScroll=2e3,this.additionalParams={},this.isSSR=!1,this.throttleScroll=new h.x,this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}ngOnInit(){!this.isSSR&&O.Z.isServer?this.isLoading=!0:this.fetchData()}ngAfterViewInit(){var r=this;return(0,a.Z)(function*(){O.Z.isServer||r.scrollContainer&&(r.scrollElement=yield r.scrollContainer.getScrollElement(),r.scrollContainer.ionScroll.pipe((0,d.R)(r.destroyStream$)).subscribe(y=>{r.scrollElement.scrollHeight-y.detail.scrollTop<r.offsetScroll&&r.throttleScroll.next(1)}),r.throttleScroll.pipe((0,_.p)(300),(0,d.R)(r.destroyStream$)).subscribe(()=>{r.fetchData()}))})()}fetchData(){var r=this;return(0,a.Z)(function*(){if(!r.isLoading&&(-1===r.page||r.products.length<r.total)){r.isLoading=!0,r.page++,r.cdr.markForCheck();const y=yield(0,P.n)(r.productService.getProductsByMetaParamsV2({page:r.page,rows:r.pageSize,traceId:r.userService.traceId,isRecommended:!0,...r.additionalParams}));r.products=[...r.products,...y.rows||[]],r.products=(0,S.DI)(r.products),r.total=y.total,r.isLoading=!1,r.cdr.markForCheck()}})()}clear(){this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}trackByFn(r,y){return y.id}trackByFn2(r){return r}}return g.\u0275fac=function(r){return new(r||g)(o.Y36(u.s),o.Y36(l.K),o.Y36(o.sBO))},g.\u0275cmp=o.Xpm({type:g,selectors:[["app-products-infinite-scroll"]],inputs:{pageSize:"pageSize",scrollContainer:"scrollContainer",offsetScroll:"offsetScroll",additionalParams:"additionalParams",isSSR:"isSSR"},standalone:!0,features:[o.qOj,o.jDz],decls:4,vars:3,consts:[[1,"flex","flex-wrap","-mx-1"],["class","px-1 flex-shrink-0 mb-6 flex justify-center",3,"product",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"px-1","flex-shrink-0","mb-6","flex","justify-center",3,"product"],["class","px-1 flex-shrink-0 mb-6 flex justify-center",4,"ngFor","ngForOf","ngForTrackBy"],[1,"px-1","flex-shrink-0","mb-6","flex","justify-center"]],template:function(r,y){1&r&&(o.TgZ(0,"div")(1,"div",0),o.YNc(2,T,1,1,"app-product-card",1),o.YNc(3,L,2,3,"ng-container",2),o.qZA()()),2&r&&(o.xp6(2),o.Q6J("ngForOf",y.products)("ngForTrackBy",y.trackByFn),o.xp6(1),o.Q6J("ngIf",y.isLoading))},dependencies:[t.aw,C.ez,C.sg,C.O5,x.Pc,n.m,m.Y,i.I],styles:["app-product-card[_ngcontent-%COMP%], app-product-card-skeleton[_ngcontent-%COMP%]{width:50%}@media (min-width: 340px){app-product-card[_ngcontent-%COMP%], app-product-card-skeleton[_ngcontent-%COMP%]{width:33.3333333333%}}@media (min-width: 640px){app-product-card[_ngcontent-%COMP%], app-product-card-skeleton[_ngcontent-%COMP%]{width:25%}}@media (min-width: 768px){app-product-card[_ngcontent-%COMP%], app-product-card-skeleton[_ngcontent-%COMP%]{width:20%}}@media (min-width: 1024px){app-product-card[_ngcontent-%COMP%], app-product-card-skeleton[_ngcontent-%COMP%]{width:16.6666666667%}}"],changeDetection:0}),g})()},50738:(B,E,e)=>{e.r(E),e.d(E,{PaymentModule:()=>M});var a=e(44466),h=e(7507),d=e(15861),_=e(11781),P=e(72588),O=e(82722),x=e(5565),t=e(94650),C=e(80164),n=e(52313),i=e(46032),f=e(5068),S=e(49127),o=e(45210),u=e(18215),l=e(95133),m=e(36895),T=e(85898);const D=["header"];function Z(p,A){if(1&p&&(t.TgZ(0,"span",15),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&p){const s=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,s.payResult.amount))}}function L(p,A){if(1&p){const s=t.EpF();t.TgZ(0,"ion-button",16),t.NdJ("click",function(){t.CHM(s);const v=t.oxw();return t.KtG(v.pay())}),t._uU(1," \u7acb\u5373\u652f\u4ed8 "),t.qZA()}if(2&p){const s=t.oxw();t.Q6J("disabled",s.loading.platform)}}function I(p,A){1&p&&(t.TgZ(0,"ion-list",17)(1,"ion-item")(2,"ion-label")(3,"h3"),t._UZ(4,"ion-skeleton-text",18),t.qZA(),t.TgZ(5,"p"),t._UZ(6,"ion-skeleton-text",18),t.qZA(),t.TgZ(7,"p"),t._UZ(8,"ion-skeleton-text",18),t.qZA(),t.TgZ(9,"h3"),t._UZ(10,"ion-skeleton-text",18),t.qZA(),t.TgZ(11,"p"),t._UZ(12,"ion-skeleton-text",18),t.qZA(),t.TgZ(13,"p"),t._UZ(14,"ion-skeleton-text",18),t.qZA(),t.TgZ(15,"h3"),t._UZ(16,"ion-skeleton-text",18),t.qZA(),t.TgZ(17,"p"),t._UZ(18,"ion-skeleton-text",18),t.qZA(),t.TgZ(19,"p"),t._UZ(20,"ion-skeleton-text",18),t.qZA(),t.TgZ(21,"h3"),t._UZ(22,"ion-skeleton-text",18),t.qZA(),t.TgZ(23,"p"),t._UZ(24,"ion-skeleton-text",18),t.qZA(),t.TgZ(25,"p"),t._UZ(26,"ion-skeleton-text",18),t.qZA()()()()),2&p&&(t.xp6(4),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0),t.xp6(2),t.Q6J("animated",!0))}const g=function(){return{isRecommended:!1,activityId:"40597823"}},r=[{path:"",component:(()=>{class p extends x.V{constructor(s,c,v,U){super(),this.activatedRoute=s,this.router=c,this.CheckoutService=v,this.renderer=U,this.PaymentPlatformEnum=_.fS,this.loading={getData:!1,platform:!1,pay:!1},this.lastScrollTop=0,this.successCallbackUri=""}get showPayBtn(){return Object.is(this.payResult?.platformCode.split("-").shift(),_.fS.STRIPE)}ngOnInit(){const{id:s}=this.activatedRoute.snapshot.queryParams;this.loading.getData=!0,this.loading.platform=!0,this.CheckoutService.queryPaymentOrder(s).pipe((0,O.R)(this.destroyStream$)).subscribe({next:c=>{if(this.payResult=c.data,console.log(this.payResult),Object.is(this.payResult?.status,_.P1.PENDING))switch(c.data.platformCode.split("-").shift()){case _.fS.STRIPE:this.loadStripe();break;case _.fS.TRIPLE:this.loadTriple()}else this.router.navigateByUrl(`/pay/result/${this.payResult?.id}`,{replaceUrl:!0})},error:c=>{console.error(c)}}).add(()=>this.loading.getData=!1)}onContentScroll(s){const c=s.detail.scrollTop;c>=50&&this.lastScrollTop<c?this.renderer.addClass(this.header.el,"top-toolbar-hide"):this.renderer.removeClass(this.header.el,"top-toolbar-hide"),this.lastScrollTop=c}loadStripe(){var s=this;return(0,d.Z)(function*(){try{const c=JSON.parse(s.payResult.clientJson),{clientSecret:v,pubKey:U,successUri:b}=c,F=yield(0,P.J)(U),k={text:"\u7b80\u4f53\u4e2d\u6587",abbr:"\u{1f1e8}\u{1f1f3}",stripe:"zh",tripleA:"zh"};if(s.successCallbackUri=b,!F)return;s.stripe=F,s.stripeElements=F.elements({appearance:{theme:"stripe"},locale:k.stripe,clientSecret:v}),s.stripeElements.create("payment").mount("#payment-element")}catch(c){console.error(c)}finally{s.loading.platform=!1}})()}loadTriple(){const s=JSON.parse(this.payResult.clientJson),c=document.querySelector("#payment-element");!c||(c.innerHTML=`\n  <triplea-ecommerce-payment-v1\n  id="payment"\n  payment-reference="${s.paymentReference}"\n  access-token="${s.accessToken}"\n  lang="zh"\n>\n</triplea-ecommerce-payment-v1>\n  `)}pay(){var s=this;return(0,d.Z)(function*(){const{platformCode:c}=s.payResult;c.split("-").shift()===_.fS.STRIPE&&s.stripePay()})()}stripePay(){var s=this;return(0,d.Z)(function*(){s.loading.pay=!0;try{const{error:c}=yield s.stripe.confirmPayment({elements:s.stripeElements,confirmParams:{return_url:s.successCallbackUri}});console.log(c)}catch(c){console.error(c)}finally{s.loading.pay=!1}})()}}return p.\u0275fac=function(s){return new(s||p)(t.Y36(h.gz),t.Y36(h.F0),t.Y36(C.Z),t.Y36(t.Qsj))},p.\u0275cmp=t.Xpm({type:p,selectors:[["app-payment"]],viewQuery:function(s,c){if(1&s&&t.Gf(D,5),2&s){let v;t.iGM(v=t.CRH())&&(c.header=v.first)}},features:[t.qOj],decls:19,vars:10,consts:[["fullscreen","true","scrollEvents","true","backToTopBtn","",3,"ionScroll"],["ionContent",""],["appOverflowVisible","",1,"sticky","top-0","shadow-lg","z-50"],["header",""],[3,"forceFullWidthSearch"],[1,"w-full"],[1,"payment-container"],[1,"pay-amount"],["class","amount",4,"ngIf"],["id","payment-element"],["class","btn-pay","size","large","expand","block",3,"disabled","click",4,"ngIf"],["class","skeleton",4,"ngIf"],[1,"tyqoon-container","min-h-[50vh]","mt-4"],[3,"additionalParams","scrollContainer","isSSR"],[1,"mt-4","md:hidden"],[1,"amount"],["size","large","expand","block",1,"btn-pay",3,"disabled","click"],[1,"skeleton"],[2,"width","100%",3,"animated"]],template:function(s,c){if(1&s&&(t.TgZ(0,"ion-content",0,1),t.NdJ("ionScroll",function(U){return c.onContentScroll(U)}),t._UZ(2,"app-global-customer-service"),t.TgZ(3,"ion-toolbar",2,3),t._UZ(5,"app-top-navbar",4)(6,"app-top-menu"),t.qZA(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7),t._uU(10," \u652f\u4ed8\u91d1\u989d\uff1a"),t.YNc(11,Z,3,3,"span",8),t.qZA(),t._UZ(12,"div",9),t.YNc(13,L,2,1,"ion-button",10),t.qZA(),t.YNc(14,I,27,12,"ion-list",11),t.qZA(),t.TgZ(15,"div",12),t._UZ(16,"app-products-infinite-scroll",13),t.qZA()(),t.TgZ(17,"ion-footer",14),t._UZ(18,"app-bottom-navbar"),t.qZA()),2&s){const v=t.MAs(1);t.xp6(5),t.Q6J("forceFullWidthSearch",!0),t.xp6(3),t.ekj("show",!c.loading.getData),t.xp6(3),t.Q6J("ngIf",c.payResult),t.xp6(2),t.Q6J("ngIf",c.showPayBtn),t.xp6(1),t.Q6J("ngIf",c.loading.getData),t.xp6(2),t.Q6J("additionalParams",t.DdM(9,g))("scrollContainer",v)("isSSR",!0)}},dependencies:[n.p,i.K,f.z,S.H,o.B,u.Z,l.YG,l.W2,l.fr,l.Ie,l.Q$,l.q_,l.CK,l.sr,m.O5,T.b,m.H9],styles:[".payment-container[_ngcontent-%COMP%]{padding:32px 0;flex-direction:column;justify-content:center;max-width:800px;margin:0 auto;display:flex;height:0;overflow:hidden}.payment-container.show[_ngcontent-%COMP%]{min-height:70vh;height:auto;overflow:unset}.payment-container[_ngcontent-%COMP%]   .btn-pay[_ngcontent-%COMP%]{margin-top:24px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]{text-align:center;margin-bottom:12px;font-size:36px}.payment-container[_ngcontent-%COMP%]   .pay-amount[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{color:red;font-weight:700}.skeleton[_ngcontent-%COMP%]{min-height:70vh}"]}),p})()}];let y=(()=>{class p{}return p.\u0275fac=function(s){return new(s||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[h.Bz.forChild(r),h.Bz]}),p})(),M=(()=>{class p{}return p.\u0275fac=function(s){return new(s||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[a.m,y,l.Pc,T.b]}),p})()},59809:(B,E,e)=>{e.d(E,{I:()=>h});var a=e(94650);let h=(()=>{class d{}return d.\u0275fac=function(P){return new(P||d)},d.\u0275cmp=a.Xpm({type:d,selectors:[["app-product-card-skeleton"]],standalone:!0,features:[a.jDz],decls:9,vars:0,consts:[[1,"cursor-pointer","flex","flex-col","w-full","max-w-[246px]","lg:max-w-[220px]","xl:max-w-[245px]"],[1,"relative","w-full","mb-2",2,"padding-top","100%"],[1,"absolute","inset-0","pulSate","rounded-lg"],[1,"product-title","truncate","mb-1","pulSate","text-sm",2,"letter-spacing","20px"],[1,"text-xs","leading-3","text-center","pulSate",2,"letter-spacing","20px"],[1,"text-base","text-center","pulSate",2,"letter-spacing","20px"]],template:function(P,O){1&P&&(a.TgZ(0,"div",0)(1,"div",1),a._UZ(2,"div",2),a.qZA(),a.TgZ(3,"p",3),a._uU(4," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),a.qZA(),a.TgZ(5,"p",4),a._uU(6," \xa0\xa0 "),a.qZA(),a.TgZ(7,"p",5),a._uU(8," \xa0\xa0 "),a.qZA()())}}),d})()},72588:(B,E,e)=>{e.d(E,{J:()=>f});var a="https://js.stripe.com/v3",h=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,d="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",x=null,C=function(o,u,l){if(null===o)return null;var m=o.apply(void 0,u);return function(o,u){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"1.46.0",startTime:u})}(m,l),m},n=Promise.resolve().then(function(){return o=null,null!==x||(x=new Promise(function(u,l){if(typeof window>"u")u(null);else if(window.Stripe&&o&&console.warn(d),window.Stripe)u(window.Stripe);else try{var m=function(){for(var o=document.querySelectorAll('script[src^="'.concat(a,'"]')),u=0;u<o.length;u++){var l=o[u];if(h.test(l.src))return l}return null}();m&&o?console.warn(d):m||(m=function(o){var u=o&&!o.advancedFraudSignals?"?advancedFraudSignals=false":"",l=document.createElement("script");l.src="".concat(a).concat(u);var m=document.head||document.body;if(!m)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return m.appendChild(l),l}(o)),m.addEventListener("load",function(){window.Stripe?u(window.Stripe):l(new Error("Stripe.js not available"))}),m.addEventListener("error",function(){l(new Error("Failed to load Stripe.js"))})}catch(T){return void l(T)}})),x;var o}),i=!1;n.catch(function(S){i||console.warn(S)});var f=function(){for(var o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];i=!0;var m=Date.now();return n.then(function(T){return C(T,u,m)})}}}]);