"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[9172],{39172:(P,Z,l)=>{l.d(Z,{c:()=>q});var a=l(15861),g=l(36895),e=l(98274),s=l(24006),n=l(95133),m=l(54463),p=l(49808),h=l(82722),A=l(5565),C=l(80164);function x(o,d){if(1&o&&(e.TgZ(0,"ion-select-option",30),e._uU(1),e.qZA()),2&o){const t=d.$implicit;e.s9C("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function b(o,d){if(1&o&&(e.TgZ(0,"ion-select-option",30),e._uU(1),e.qZA()),2&o){const t=d.$implicit;e.s9C("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function T(o,d){if(1&o&&(e.TgZ(0,"ion-select",31),e.ALo(1,"translate"),e.YNc(2,b,2,2,"ion-select-option",18),e.qZA()),2&o){const t=e.oxw(3);e.Q6J("disabled",t.isLoadingCities)("placeholder",e.lcZ(1,3,"account-add-shipping-address-city-placeholder")),e.xp6(2),e.Q6J("ngForOf",t.cities)}}function y(o,d){if(1&o&&(e.TgZ(0,"ion-select-option",30),e._uU(1),e.qZA()),2&o){const t=d.$implicit;e.s9C("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function M(o,d){if(1&o&&(e.TgZ(0,"ion-select",32),e.ALo(1,"translate"),e.YNc(2,y,2,2,"ion-select-option",18),e.qZA()),2&o){const t=e.oxw(3);e.Q6J("disabled",t.isLoadingRegions)("placeholder",e.lcZ(1,3,"account-add-shipping-address-region-placeholder")),e.xp6(2),e.Q6J("ngForOf",t.regions)}}function O(o,d){if(1&o&&(e.TgZ(0,"ion-select-option",30),e._uU(1),e.qZA()),2&o){const t=d.$implicit;e.s9C("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function E(o,d){if(1&o&&(e.TgZ(0,"ion-select",33),e.ALo(1,"translate"),e.YNc(2,O,2,2,"ion-select-option",18),e.qZA()),2&o){const t=e.oxw(3);e.Q6J("disabled",t.isLoadingStreets)("placeholder",e.lcZ(1,3,"account-add-shipping-address-region-placeholder")),e.xp6(2),e.Q6J("ngForOf",t.streets)}}function k(o,d){if(1&o&&(e.TgZ(0,"form",10)(1,"div",11)(2,"div",12),e._uU(3),e.ALo(4,"translate"),e.TgZ(5,"sup",13),e._uU(6,"*"),e.qZA()(),e.TgZ(7,"div",14),e._UZ(8,"ion-input",15),e.qZA()(),e.TgZ(9,"div",11)(10,"div",12),e._uU(11),e.ALo(12,"translate"),e.TgZ(13,"sup",13),e._uU(14,"*"),e.qZA()(),e.TgZ(15,"div",16)(16,"ion-select",17),e.ALo(17,"translate"),e.YNc(18,x,2,2,"ion-select-option",18),e.qZA(),e.YNc(19,T,3,5,"ion-select",19),e.YNc(20,M,3,5,"ion-select",20),e.YNc(21,E,3,5,"ion-select",21),e.qZA()(),e.TgZ(22,"div",11)(23,"div",12),e._uU(24),e.ALo(25,"translate"),e.TgZ(26,"sup",13),e._uU(27,"*"),e.qZA()(),e.TgZ(28,"div",14),e._UZ(29,"ion-input",22),e.qZA()(),e.TgZ(30,"div",11)(31,"div",12),e._uU(32),e.ALo(33,"translate"),e.TgZ(34,"sup",13),e._uU(35,"*"),e.qZA()(),e.TgZ(36,"div",14),e._UZ(37,"ion-input",23),e.qZA()(),e.TgZ(38,"div",11)(39,"div",12),e._uU(40),e.ALo(41,"translate"),e.TgZ(42,"sup",13),e._uU(43,"*"),e.qZA()(),e.TgZ(44,"div",14),e._UZ(45,"ion-input",24),e.qZA()(),e.TgZ(46,"div",25)(47,"div",12),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"div",26)(51,"ion-item",27),e._UZ(52,"ion-checkbox",28),e.TgZ(53,"ion-label",29),e._uU(54),e.ALo(55,"translate"),e.qZA()()()()()),2&o){const t=e.oxw(2);e.Q6J("formGroup",t.addressForm),e.xp6(3),e.hij(" ",e.lcZ(4,13,"account-add-shipping-address-receiver")," "),e.xp6(8),e.hij(" ",e.lcZ(12,15,"account-add-shipping-address-area")," "),e.xp6(5),e.Q6J("placeholder",e.lcZ(17,17,"account-add-shipping-address-area")),e.xp6(2),e.Q6J("ngForOf",t.provinces),e.xp6(1),e.Q6J("ngIf",null==t.cities?null:t.cities.length),e.xp6(1),e.Q6J("ngIf",null==t.regions?null:t.regions.length),e.xp6(1),e.Q6J("ngIf",null==t.streets?null:t.streets.length),e.xp6(3),e.hij(" ",e.lcZ(25,19,"account-add-shipping-address-address")," "),e.xp6(8),e.hij(" ",e.lcZ(33,21,"account-add-shipping-address-post-code")," "),e.xp6(8),e.hij(" ",e.lcZ(41,23,"account-add-shipping-address-telephone")," "),e.xp6(8),e.hij(" ",e.lcZ(49,25,"account-add-shipping-address-set-up")," "),e.xp6(6),e.Oqu(e.lcZ(55,27,"checkout-shipping-change-default"))}}function F(o,d){if(1&o){const t=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-buttons",2)(6,"ion-button",3),e.NdJ("click",function(){e.CHM(t),e.oxw();const r=e.MAs(1);return e.KtG(r.dismiss())}),e._uU(7,"\u2715"),e.qZA()()()(),e.TgZ(8,"div",4),e.YNc(9,k,56,29,"form",5),e.qZA(),e._UZ(10,"div",6),e.TgZ(11,"div",7)(12,"button",8),e.NdJ("click",function(){e.CHM(t),e.oxw();const r=e.MAs(1);return e.KtG(r.dismiss())}),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"button",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(),c=e.MAs(1);return e.KtG(r.handleSubmit(c))}),e._uU(16),e.ALo(17,"translate"),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,5,t.editMode?"checkout-shipping-edit":"checkout-shipping-add")),e.xp6(6),e.Q6J("ngIf",t.addressForm),e.xp6(4),e.Oqu(e.lcZ(14,7,"account-info-remove-cancel")),e.xp6(2),e.Q6J("disabled",t.isLoadingCities||t.isLoadingRegions),e.xp6(1),e.Oqu(e.lcZ(17,9,t.editMode?"checkout-shipping-edit-btn":"checkout-shipping-add-btn"))}}let q=(()=>{class o extends A.V{constructor(t,i,r,c,u){super(),this.fb=t,this.checkoutService=i,this.cdr=r,this.toast=c,this.i18n=u,this.isOpenChange=new e.vpe,this.onSuccess=new e.vpe,this.provinces=[],this.cities=[],this.regions=[],this.streets=[],this.editMode=!1,this.isLoadingCities=!1,this.isLoadingRegions=!1,this.isLoadingStreets=!1}ngOnInit(){var t=this;return(0,a.Z)(function*(){yield t.createForm(),t.onChanges()})()}toastError(t){var i=this;return(0,a.Z)(function*(){yield i.presentToast({position:"bottom",message:t,icon:"alert-circle-outline",duration:1e3,color:"danger"})})()}toastSuccess(t){var i=this;return(0,a.Z)(function*(){yield i.presentToast({position:"bottom",message:t,duration:1e3,icon:"checkmark-circle-outline",color:"success"})})()}presentToast(t){var i=this;return(0,a.Z)(function*(){yield(yield i.toast.create(t)).present()})()}createForm(){var t=this;return(0,a.Z)(function*(){if(t.addressForm=t.fb.group({consignee:["",[s.kI.required]],address:["",[s.kI.required]],zipCode:["",[s.kI.required]],phone:[""],isDefault:[!1],areaId:[""],province:["",[s.kI.required]],city:[""],region:[""],streets:[""]}),yield t.getProvinces(),t.currAddress&&(t.editMode=!0,t.addressDetail=(yield(0,p.n)(t.checkoutService.getAddressDetail(t.currAddress.id)))?.data,t.addressDetail)){const{areaDetails:i,...r}=t.addressDetail;t.addressForm.patchValue({...r});let c=[];i&&(i[0]&&c.push(t.getCities(i[0].value)),i[1]&&c.push(t.getRegions(i[1].value)),i[2]&&c.push(t.getStreets(i[2].value)),yield Promise.all(c),yield new Promise(u=>{setTimeout(()=>{t.addressForm.patchValue({province:i[0]?.value||"",city:i[1]?.value||"",region:i[2]?.value||"",streets:i[3]?.value||""}),u(null)},0)}))}})()}onChanges(){var t=this;this.addressForm.get("province")?.valueChanges.pipe((0,h.R)(this.destroyStream$)).subscribe(function(){var i=(0,a.Z)(function*(r){t.regions=[],yield t.getCities(r),t.addressForm.get("city")?.setValue(""),t.addressForm.get("region")?.setValue(""),t.cities?.length>0&&t.addressForm.get("region")?.removeValidators(s.kI.required),t.cdr.markForCheck()});return function(r){return i.apply(this,arguments)}}()),this.addressForm.get("city")?.valueChanges.pipe((0,h.R)(this.destroyStream$)).subscribe(function(){var i=(0,a.Z)(function*(r){t.addressForm.get("region")?.setValue(""),r?yield t.getRegions(r):(t.regions=[],t.addressForm.get("region")?.setValue(""),t.addressForm.get("region")?.removeValidators(s.kI.required)),t.cdr.markForCheck()});return function(r){return i.apply(this,arguments)}}()),this.addressForm.get("region")?.valueChanges.pipe((0,h.R)(this.destroyStream$)).subscribe(function(){var i=(0,a.Z)(function*(r){t.addressForm.get("streets")?.setValue(""),r?yield t.getStreets(r):(t.streets=[],t.addressForm.get("streets")?.setValue(""),t.addressForm.get("streets")?.removeValidators(s.kI.required)),t.cdr.markForCheck()});return function(r){return i.apply(this,arguments)}}())}getProvinces(){var t=this;return(0,a.Z)(function*(){t.provinces=[],t.provinces=(yield(0,p.n)(t.checkoutService.getAreaData()))?.data||[]})()}getCities(t){var i=this;return(0,a.Z)(function*(){i.isLoadingCities=!0,i.cities=(yield(0,p.n)(i.checkoutService.getAreaData(t)))?.data||[],i.cities?.length>0?i.addressForm.get("city")?.addValidators(s.kI.required):(i.addressForm.get("city")?.removeValidators(s.kI.required),i.addressForm.get("region")?.removeValidators(s.kI.required)),i.isLoadingCities=!1})()}getRegions(t){var i=this;return(0,a.Z)(function*(){i.isLoadingRegions=!0,i.regions=(yield(0,p.n)(i.checkoutService.getAreaData(t)))?.data||[],i.regions.length?i.addressForm.get("region")?.addValidators(s.kI.required):(i.addressForm.get("region")?.setValue(""),i.addressForm.get("region")?.removeValidators(s.kI.required)),i.isLoadingRegions=!1})()}getStreets(t){var i=this;return(0,a.Z)(function*(){i.isLoadingStreets=!0,i.streets=(yield(0,p.n)(i.checkoutService.getAreaData(t)))?.data||[],i.streets.length?i.addressForm.get("streets")?.addValidators(s.kI.required):(i.addressForm.get("streets")?.setValue(""),i.addressForm.get("streets")?.removeValidators(s.kI.required)),i.isLoadingStreets=!1})()}handleSubmit(t){var i=this;return(0,a.Z)(function*(){if(i.addressForm.valid){const{zipCode:r,phone:c,isDefault:u,consignee:f,address:v,streets:L,region:I,city:U,province:D}=i.addressForm.value;let _;_=i.streets?.length?L:i.regions?.length?I:i.cities?.length?U:D,i.editMode?(yield(0,p.n)(i.checkoutService.saveAddress({zipCode:r,phone:c,isDefault:u,consignee:f,address:v,areaId:_,id:i.currAddress?.id})),t.dismiss(),i.onSuccess.emit(!0)):(yield(0,p.n)(i.checkoutService.createNewAddress({zipCode:r,phone:c,isDefault:u,consignee:f,address:v,areaId:_})),t.dismiss(),i.onSuccess.emit(!0),i.toastSuccess(i.i18n.instant("order-detail-add-cart-success")))}else i.toastError(i.i18n.instant("user-address-modal-form"))})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(s.qu),e.Y36(C.Z),e.Y36(e.sBO),e.Y36(n.yF),e.Y36(m.sK))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit-address-modal"]],inputs:{isOpen:"isOpen",currAddress:"currAddress"},outputs:{isOpenChange:"isOpenChange",onSuccess:"onSuccess"},standalone:!0,features:[e.qOj,e.jDz],decls:3,vars:1,consts:[[3,"isOpen","didDismiss"],["modal",""],["slot","end"],[3,"click"],[1,"p-4"],[3,"formGroup",4,"ngIf"],[1,"border-b","border-[#dddddd]"],[1,"flex","justify-end","p-4"],[1,"rounded","border","border-[#dddddd]","py-2","px-4","capitalize",3,"click"],[1,"bg-primary","ml-2","rounded","text-white","py-2","px-4","capitalize",3,"disabled","click"],[3,"formGroup"],[1,"form-group-control","mb-6"],[1,"form-label"],[1,"text-red-500"],[1,"form-input"],["formControlName","consignee"],[1,"form-input","flex"],["interface","popover","formControlName","province",1,"rounded","px-2","py-1","border","border-[#dddddd]","mr-2",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["class","rounded px-2 py-1 border border-[#dddddd] mr-2","interface","popover","formControlName","city",3,"disabled","placeholder",4,"ngIf"],["class","rounded px-2 py-1 border border-[#dddddd] mr-2","interface","popover","formControlName","region",3,"disabled","placeholder",4,"ngIf"],["class","rounded px-2 py-1 border border-[#dddddd] mr-2","interface","popover","formControlName","streets",3,"disabled","placeholder",4,"ngIf"],["formControlName","address"],["formControlName","zipCode"],["formControlName","phone"],[1,"form-group-control","mb-2"],[1,"form-input","flex","items-center"],["lines","none",1,"no-ripple"],["formControlName","isDefault",1,"my-0","mr-2"],[1,"opacity-70"],[3,"value"],["interface","popover","formControlName","city",1,"rounded","px-2","py-1","border","border-[#dddddd]","mr-2",3,"disabled","placeholder"],["interface","popover","formControlName","region",1,"rounded","px-2","py-1","border","border-[#dddddd]","mr-2",3,"disabled","placeholder"],["interface","popover","formControlName","streets",1,"rounded","px-2","py-1","border","border-[#dddddd]","mr-2",3,"disabled","placeholder"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-modal",0,1),e.NdJ("didDismiss",function(){return i.isOpenChange.emit(!1)}),e.YNc(2,F,18,11,"ng-template"),e.qZA()),2&t&&e.Q6J("isOpen",i.isOpen)},dependencies:[g.ez,g.sg,g.O5,s.u5,s._Y,s.JJ,s.JL,s.UX,s.sg,s.u,m.aw,m.X$,n.Pc,n.YG,n.Sm,n.nz,n.Gu,n.pK,n.Ie,n.Q$,n.t9,n.n0,n.wd,n.sr,n.ki,n.w,n.QI,n.j9],styles:["ion-modal[_ngcontent-%COMP%]{--width: 560px;--background: white;--border-radius: 8px}.form-label[_ngcontent-%COMP%]{width:100%}@media (min-width: 768px){.form-label[_ngcontent-%COMP%]{width:16.666667%;text-align:right}}.form-input[_ngcontent-%COMP%]{width:100%}@media (min-width: 768px){.form-input[_ngcontent-%COMP%]{width:83.333333%;padding-left:.5rem}}ion-input[_ngcontent-%COMP%]{border-radius:.25rem;border-width:1px;--tw-border-opacity: 1;border-color:rgb(221 221 221 / var(--tw-border-opacity));--padding-bottom: 2px;--padding-top: 2px}ion-select[_ngcontent-%COMP%]{width:120px;background-color:#f2f4f3}.form-group-control[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}ion-item[_ngcontent-%COMP%]{--background: transparent;--border-width: 0px;--background-hover: transparent;--padding-start: 0;--padding-end: 0;--min-height: 12px}"]}),o})()}}]);