"use strict";(self.webpackChunkangular_tyqoon_client=self.webpackChunkangular_tyqoon_client||[]).push([[210,9127],{24499:(O,v,n)=>{n.d(v,{c:()=>g});var c=n(5565),l=n(94650);const p=["header"];let g=(()=>{class u extends c.V{constructor(d,m){super(),this.element=d,this.renderer=m,this.lastScrollTop=0}ionViewWillEnter(){this.renderer.setStyle(this.header.el,"webkitTransition","transform 700ms")}onContentScroll(d){const m=d.detail.scrollTop;m>=50&&this.lastScrollTop<m?this.renderer.addClass(this.header.el,"top-toolbar-hide"):this.renderer.removeClass(this.header.el,"top-toolbar-hide"),this.lastScrollTop=m}}return u.\u0275fac=function(d){return new(d||u)(l.Y36(l.SBq),l.Y36(l.Qsj))},u.\u0275cmp=l.Xpm({type:u,selectors:[["ng-component"]],viewQuery:function(d,m){if(1&d&&l.Gf(p,5),2&d){let t;l.iGM(t=l.CRH())&&(m.header=t.first)}},features:[l.qOj],decls:0,vars:0,template:function(d,m){},encapsulation:2}),u})()},85898:(O,v,n)=>{n.d(v,{b:()=>b});var c=n(15861),l=n(77579),p=n(82722),g=n(59468),u=n(49808),_=n(24837),d=n(95133),m=n(54463),t=n(36895),S=n(44466),P=n(59809),x=n(5565),y=n(18110),o=n(94650),E=n(35482),M=n(94830),C=n(56889),R=n(23284),D=n(90147);function A(s,h){if(1&s&&o._UZ(0,"app-product-card",5),2&s){const e=h.$implicit,a=o.oxw().ngLet,i=o.oxw().ngLet,r=o.oxw().ngLet;o.Q6J("product",e)("isBiddingMode",!!a)("canLaunchPool",!!r)("isLogin",!!i)}}function T(s,h){1&s&&o._UZ(0,"app-product-card-skeleton",7)}const B=function(){return[]};function I(s,h){if(1&s&&(o.ynx(0),o.YNc(1,T,1,0,"app-product-card-skeleton",6),o.BQk()),2&s){const e=o.oxw(4);o.xp6(1),o.Q6J("ngForOf",o.DdM(2,B).constructor(e.pageSize).fill(1))("ngForTrackBy",e.trackByFn2)}}function Z(s,h){if(1&s&&(o.TgZ(0,"div",2),o.YNc(1,A,1,4,"app-product-card",3),o.YNc(2,I,2,3,"ng-container",4),o.qZA()),2&s){const e=o.oxw(3);o.xp6(1),o.Q6J("ngForOf",e.products)("ngForTrackBy",e.trackByFn),o.xp6(1),o.Q6J("ngIf",e.isLoading)}}function K(s,h){if(1&s&&(o.TgZ(0,"div"),o.YNc(1,Z,3,3,"div",1),o.ALo(2,"async"),o.qZA()),2&s){const e=o.oxw(2);o.xp6(1),o.Q6J("ngLet",o.lcZ(2,1,e.biddingService.isBiddingMode$))}}function L(s,h){if(1&s&&(o.ynx(0),o.YNc(1,K,3,3,"div",0),o.ALo(2,"async"),o.BQk()),2&s){const e=o.oxw();o.xp6(1),o.Q6J("ngLet",o.lcZ(2,1,e.userService.userInfo$))}}let b=(()=>{class s extends x.V{constructor(e,a,i,r){super(),this.productService=e,this.userService=a,this.biddingService=i,this.cdr=r,this.pageSize=20,this.offsetScroll=2e3,this.additionalParams={},this.isSSR=!1,this.biddingProductsSortOrder=0,this.throttleScroll=new l.x,this.page=-1,this.isLoading=!1,this.total=0,this.products=[],this.isBiddingMode=!1}ngOnInit(){console.log(8787878,this.biddingProductsSortOrder),!this.isSSR&&_.Z.isServer?this.isLoading=!0:this.biddingService.isBiddingMode$.pipe((0,p.R)(this.destroyStream$)).subscribe(e=>{this.isBiddingMode=e,this.refreshProducts()})}ngAfterViewInit(){var e=this;return(0,c.Z)(function*(){_.Z.isServer||e.scrollContainer&&(e.scrollElement=yield e.scrollContainer.getScrollElement(),e.scrollContainer.ionScroll.pipe((0,p.R)(e.destroyStream$)).subscribe(a=>{e.scrollElement.scrollHeight-a.detail.scrollTop<e.offsetScroll&&e.throttleScroll.next(1)}),e.throttleScroll.pipe((0,g.p)(300),(0,p.R)(e.destroyStream$)).subscribe(()=>{e.fetchData()}))})()}ngOnChanges(e){}refreshProducts(){this.page=-1,this.total=0,this.products=[],this.fetchData()}fetchData(){var e=this;return(0,c.Z)(function*(){if(!e.isLoading&&(-1===e.page||e.products.length<e.total)){e.isLoading=!0,e.page++,e.cdr.markForCheck();const a=e.isBiddingMode?yield(0,u.n)(e.biddingService.getProductsWithPoolInfo({page:e.page,rows:e.pageSize,sortType:e.biddingProductsSortOrder,isRecommended:!0,...e.additionalParams})):yield(0,u.n)(e.productService.getProductsByMetaParamsV2({page:e.page,rows:e.pageSize,traceId:e.userService.traceId,isRecommended:!0,...e.additionalParams}));console.log(a),a.rows=(0,y.DI)(a.rows||[]),e.products=[...e.products,...a.rows||[]],e.total=a.total,e.isLoading=!1,e.cdr.markForCheck()}})()}clear(){this.page=-1,this.isLoading=!1,this.total=0,this.products=[]}trackByFn(e,a){return a.id}trackByFn2(e){return e}}return s.\u0275fac=function(e){return new(e||s)(o.Y36(E.s),o.Y36(M.K),o.Y36(C.g),o.Y36(o.sBO))},s.\u0275cmp=o.Xpm({type:s,selectors:[["app-products-infinite-scroll"]],inputs:{pageSize:"pageSize",scrollContainer:"scrollContainer",offsetScroll:"offsetScroll",additionalParams:"additionalParams",isSSR:"isSSR",biddingProductsSortOrder:"biddingProductsSortOrder"},standalone:!0,features:[o.qOj,o.TTD,o.jDz],decls:2,vars:3,consts:[[4,"ngLet"],["class","grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-x-2 gap-y-6",4,"ngLet"],[1,"grid","grid-cols-2","xs:grid-cols-3","sm:grid-cols-4","md:grid-cols-5","lg:grid-cols-6","gap-x-2","gap-y-6"],["class","block",3,"product","isBiddingMode","canLaunchPool","isLogin",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"block",3,"product","isBiddingMode","canLaunchPool","isLogin"],["class","block",4,"ngFor","ngForOf","ngForTrackBy"],[1,"block"]],template:function(e,a){1&e&&(o.YNc(0,L,3,3,"ng-container",0),o.ALo(1,"async")),2&e&&o.Q6J("ngLet",o.lcZ(1,1,a.biddingService.canLaunchPool$))},dependencies:[m.aw,t.ez,t.sg,t.O5,t.Ov,d.Pc,S.m,R.Y,D.h,P.I],changeDetection:0}),s})()},90210:(O,v,n)=>{n.r(v),n.d(v,{PayResultModule:()=>h});var c=n(88595),l=n(7507),p=n(15861),g=n(11781),u=n(6104),_=n(82722),d=n(15439),m=n(24499),t=n(94650),S=n(36895),P=n(95133),x=n(80164),y=n(54463),o=n(81152),E=n(46032),M=n(8136),C=n(49127),R=n(45210),D=n(18215),A=n(2628),T=n(85898);function B(e,a){if(1&e&&(t.TgZ(0,"div")(1,"div",18),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",19),t._uU(5),t.qZA()()),2&e){const i=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"payment-remain-time")),t.xp6(3),t.Oqu(i.countdown())}}function I(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){t.CHM(i);const f=t.oxw();return t.KtG(f.cancelPayment())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"order-cancel-payment")))}const Z=function(){return{isRecommended:!1,activityId:"40597823"}},L=[{path:"",component:(()=>{class e extends m.c{constructor(i,r,f,U,F,z,Y,W,k){super(W,Y),this.activeRoute=i,this.location=r,this.dict=f,this.router=U,this.toast=F,this.CheckoutService=z,this.renderer=Y,this.element=W,this.translate=k,this.DictKey=u.f,this.loading={queryPaymentOrder:!1}}ngOnInit(){this.orderId=this.activeRoute.snapshot.params.id,this.queryPaymentOrder(),setInterval(()=>{this.countdown()},1e3)}ngOnDestroy(){this.destroy(),clearInterval(this.payResultSetTimeout)}get bussinessType(){return this.dict.transform(this.payResult.businessType,this.DictKey.PAY_BUSINESS_TYPE)}get isPending(){return Object.is(this.payResult.status,g.P1.PENDING)}get primaryBtnText(){return this.isPending?"\u7acb\u5373\u652f\u4ed8":this.bussinessType.primaryBtnText}convertToDecimal(i){return i<10&&(i=0+i.toString()),i}countdown(){const i=d(this.payResult.businessExpired).unix()-d().unix(),r=this.convertToDecimal(d.duration(i,"seconds").minutes()),f=this.convertToDecimal(d.duration(i,"seconds").seconds());return this.payResult.businessExpired<(new Date).getTime()?"00:00:00":`00: ${r} : ${f}`}toastError(i){var r=this;return(0,p.Z)(function*(){yield r.presentToast({position:"bottom",message:i,icon:"alert-circle-outline",duration:1e3,color:"danger"})})()}toastSuccess(i){var r=this;return(0,p.Z)(function*(){yield r.presentToast({position:"bottom",message:i,duration:1e3,icon:"checkmark-circle-outline",color:"success"})})()}presentToast(i){var r=this;return(0,p.Z)(function*(){yield(yield r.toast.create(i)).present()})()}queryPaymentOrder(i){i||(this.loading.queryPaymentOrder=!0),this.CheckoutService.queryPaymentOrder(this.orderId).pipe((0,_.R)(this.destroyStream$)).subscribe({next:r=>{this.payResult={...r.data,expiredTime:1e3*r.data.expiredTime,businessExpired:1e3*r.data.businessExpired},Object.is(this.payResult.status,g.P1.PENDING)&&(this.payResultSetTimeout=setTimeout(()=>this.queryPaymentOrder(!0),2e3))},error:r=>{console.error(r),this.toastError(r.message)}}).add(()=>this.loading.queryPaymentOrder=!1)}primaryBtnClick(){this.isPending?this.router.navigateByUrl(`/pay?id=${this.payResult.id}`):this.router.navigateByUrl(this.bussinessType.link,{replaceUrl:!0})}back(){this.location.back()}cancelPayment(){this.CheckoutService.cancel({id:this.orderId}).pipe((0,_.R)(this.destroyStream$)).subscribe()}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(l.gz),t.Y36(S.Ye),t.Y36(u.e),t.Y36(l.F0),t.Y36(P.yF),t.Y36(x.Z),t.Y36(t.Qsj),t.Y36(t.SBq),t.Y36(y.sK))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-pay-result"]],features:[t._Bn([u.e]),t.qOj],decls:28,vars:21,consts:[[1,"page-pay-result"],["fullscreen","true","scrollEvents","true","backToTopBtn","",3,"ionScroll"],["ionContent",""],["appOverflowVisible","",1,"sticky","top-0","shadow-lg","z-50"],["header",""],[3,"forceFullWidthSearch"],[1,"w-full"],[1,"pay_title"],[1,"pending"],[4,"ngIf"],[3,"content"],[1,"btn-spot"],["color","warning",3,"click"],["color","light",3,"click"],["color","danger","class","cancel-payment",3,"click",4,"ngIf"],[1,"tyqoon-container","min-h-[50vh]","mt-4"],[3,"additionalParams","scrollContainer","isSSR"],[1,"mt-4","md:hidden"],[1,"statistic-title"],[1,"timestamp","main-title"],["color","danger",1,"cancel-payment",3,"click"]],template:function(i,r){if(1&i&&(t.TgZ(0,"div",0)(1,"ion-content",1,2),t.NdJ("ionScroll",function(U){return r.onContentScroll(U)}),t._UZ(3,"app-global-customer-service"),t.TgZ(4,"ion-toolbar",3,4),t._UZ(6,"app-top-navbar",5)(7,"app-top-menu"),t.qZA(),t.TgZ(8,"div",6)(9,"div",7),t._uU(10),t.ALo(11,"translate"),t.ALo(12,"dict"),t.qZA(),t.TgZ(13,"div",8),t.YNc(14,B,6,4,"div",9),t._UZ(15,"app-pay-content",10),t.qZA(),t.TgZ(16,"div",11)(17,"ion-button",12),t.NdJ("click",function(){return r.primaryBtnClick()}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"ion-button",13),t.NdJ("click",function(){return r.back()}),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.YNc(23,I,3,3,"ion-button",14),t.qZA()(),t.TgZ(24,"div",15),t._UZ(25,"app-products-infinite-scroll",16),t.qZA()(),t.TgZ(26,"ion-footer",17),t._UZ(27,"app-bottom-navbar"),t.qZA()()),2&i){const f=t.MAs(2);t.xp6(6),t.Q6J("forceFullWidthSearch",!0),t.xp6(4),t.Oqu(t.lcZ(11,10,t.Dn7(12,12,r.payResult.status,r.DictKey.PAY_STATUS,"tips"))),t.xp6(4),t.Q6J("ngIf",r.isPending),t.xp6(1),t.Q6J("content",r.payResult),t.xp6(3),t.Oqu(t.lcZ(19,16,r.primaryBtnText)),t.xp6(3),t.Oqu(t.lcZ(22,18,"go-back")),t.xp6(2),t.Q6J("ngIf",r.isPending),t.xp6(2),t.Q6J("additionalParams",t.DdM(20,Z))("scrollContainer",f)("isSSR",!0)}},dependencies:[o.p,E.K,M.z,C.H,R.B,D.Z,A.k,P.YG,P.W2,P.fr,P.sr,S.O5,T.b,u.e,y.X$],styles:[".page-pay-result[_ngcontent-%COMP%]{min-height:70vh;display:flex;justify-content:center;align-items:center;inset:0;position:absolute;flex-direction:column;contain:layout size style;overflow:hidden;z-index:0}.page-pay-result[_ngcontent-%COMP%]   .pay_title[_ngcontent-%COMP%]{color:#000000d9;font-size:24px;line-height:1.8;text-align:center;padding-top:50px}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]{text-align:center}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]   .statistic-title[_ngcontent-%COMP%]{margin-bottom:4px;color:#00000073;font-size:14px}.page-pay-result[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%]   .main-title[_ngcontent-%COMP%]{color:#000000d9;font-size:24px}.page-pay-result[_ngcontent-%COMP%]   .cancel-payment[_ngcontent-%COMP%]{color:#fff;margin-left:5%}.page-pay-result[_ngcontent-%COMP%]   .btn-spot[_ngcontent-%COMP%]{margin:24px 0 0;text-align:center}"]}),e})()}];let b=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[l.Bz.forChild(L),l.Bz]}),e})();var s=n(44466);let h=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[s.m,b,c.g,s.m,P.Pc,y.aw,T.b]}),e})()},59809:(O,v,n)=>{n.d(v,{I:()=>l});var c=n(94650);let l=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=c.Xpm({type:p,selectors:[["app-product-card-skeleton"]],standalone:!0,features:[c.jDz],decls:9,vars:0,consts:[[1,"cursor-pointer","flex","flex-col","w-full","max-w-[246px]","lg:max-w-[220px]","xl:max-w-[245px]"],[1,"relative","w-full","mb-2",2,"padding-top","100%"],[1,"absolute","inset-0","pulSate","rounded-lg"],[1,"product-title","truncate","mb-1","pulSate","text-sm",2,"letter-spacing","20px"],[1,"text-xs","leading-3","text-center","pulSate",2,"letter-spacing","20px"],[1,"text-base","text-center","pulSate",2,"letter-spacing","20px"]],template:function(u,_){1&u&&(c.TgZ(0,"div",0)(1,"div",1),c._UZ(2,"div",2),c.qZA(),c.TgZ(3,"p",3),c._uU(4," \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),c.qZA(),c.TgZ(5,"p",4),c._uU(6," \xa0\xa0 "),c.qZA(),c.TgZ(7,"p",5),c._uU(8," \xa0\xa0 "),c.qZA()())}}),p})()},49127:(O,v,n)=>{n.d(v,{H:()=>p});var c=n(24837),l=n(94650);let p=(()=>{class g{constructor(_){this.toolbar=_.nativeElement}ngAfterViewInit(){if(c.Z.isServer)return;const _=setInterval(()=>{if(this.toolbar.shadowRoot){let d=this.toolbar.shadowRoot.querySelector(".toolbar-container");d&&(d.style.contain="none",d.style.overflow="visible",clearInterval(_))}},500)}}return g.\u0275fac=function(_){return new(_||g)(l.Y36(l.SBq))},g.\u0275dir=l.lG2({type:g,selectors:[["","appOverflowVisible",""]]}),g})()}}]);